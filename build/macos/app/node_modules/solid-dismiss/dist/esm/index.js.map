{"version":3,"file":"index.js","sources":["../../package/global/dismissStack.ts","../../package/utils/tabbing.ts","../../package/utils/hasDisplayNone.ts","../../package/utils/isObjectLiteral.ts","../../package/utils/queryElement.ts","../../package/utils/isHiddenOrInvisibleShallow.ts","../../package/utils/checkThenClose.ts","../../package/local/menuButton.ts","../../package/local/thirdPartyPopup.ts","../../package/global/globalEvents.ts","../../package/local/menuPopup.ts","../../package/utils/camelize.ts","../../package/utils/runToggleScrollbar.ts","../../package/components/Transition.ts","../../package/local/manageLocalEvents.ts","../../package/local/container.ts","../../package/local/overlay.ts","../../package/utils/matchByFirstChild.ts","../../package/local/focusSentinel.ts","../../package/components/CustomPortal.tsx","../../package/index.tsx"],"sourcesContent":["import { TDismiss } from \"..\";\nimport { TLocalState } from \"../local/localState\";\n\nexport type TDismissStack = Pick<\n  TDismiss,\n  | \"focusElementOnClose\"\n  | \"overlayElement\"\n  | \"open\"\n  | \"setOpen\"\n  | \"mountedPopupsSafeList\"\n> &\n  Pick<\n    TLocalState,\n    | \"timeouts\"\n    | \"uniqueId\"\n    | \"cursorKeys\"\n    | \"closeWhenDocumentBlurs\"\n    | \"closeWhenMenuButtonIsTabbed\"\n    | \"closeWhenEscapeKeyIsPressed\"\n    | \"closeWhenClickingOutside\"\n    | \"upperStackRemovedByFocusOut\"\n    | \"menuPopupEl\"\n    | \"overlayEl\"\n    | \"overlay\"\n    | \"focusSentinelBeforeEl\"\n    | \"focusSentinelAfterEl\"\n    | \"ignoreMenuPopupWhenTabbing\"\n  > & {\n    id: string;\n    menuBtnEls: HTMLElement[];\n    focusedMenuBtn: { el: HTMLElement | null };\n    containerEl: HTMLElement;\n    detectIfMenuButtonObscured: boolean;\n    queueRemoval: boolean;\n  };\n\nexport const dismissStack: TDismissStack[] = [];\n\nexport const addDismissStack = (props: TDismissStack) => {\n  dismissStack.push(props!);\n};\n\nexport const removeDismissStack = (id: string) => {\n  const foundIdx = dismissStack.findIndex((item) => item.uniqueId === id);\n  if (foundIdx === -1) return;\n\n  const foundStack = dismissStack[foundIdx];\n  dismissStack.splice(foundIdx, 1);\n\n  return foundStack;\n};\n","const _tabbableSelectors = [\n  \"a[href]\",\n  \"area[href]\",\n  \"input:not([disabled])\",\n  \"select:not([disabled])\",\n  \"textarea:not([disabled])\",\n  \"button:not([disabled])\",\n  \"iframe\",\n  \"[tabindex]\",\n  \"[contentEditable=true]\",\n].reduce((a, c, idx) => `${a}${idx ? \",\" : \"\"}${c}:not([tabindex=\"-1\"])`, \"\");\n\nlet willWrap = false;\nlet originalFrom: HTMLElement | null = null;\n\ntype GetNextTabbableElement = {\n  /**\n   * Sets the relative position on getting the next tabbable element\n   *\n   * If `\"activeElement\"`, gets the current active element either from document or iframe context.\n   *\n   * If you are passing an iframe element, but intending to use current active element inside that iframe context, then use object argument `{ el: Element; getActiveElement: true }`\n   */\n  from:\n    | Element\n    | \"activeElement\"\n    | { el: Element; getActiveElement: boolean; isIframe: boolean };\n  direction?: \"forwards\" | \"backwards\";\n  stopAtRootElement?: HTMLElement;\n  /**\n   * Skips tabbable elements\n   *\n   * @defaultValue `undefined`\n   */\n  ignoreElement?: HTMLElement[];\n  allowSelectors?: string[];\n  /**\n   * To be used with `stopAtRootElement`.\n   *\n   * When `from` is the last tabbable item within `stopAtRootElement`, when continueing in the same direction, the first item will be focused within `stopAtRootElement`.\n   *\n   * @defaultValue `false`\n   */\n  wrap?: boolean;\n};\n\nexport const getNextTabbableElement = ({\n  from: _from,\n  stopAtRootElement: stopAtRootElement,\n  ignoreElement = [],\n  allowSelectors,\n  direction = \"forwards\",\n  wrap,\n}: GetNextTabbableElement) => {\n  let fromResult!: Element;\n  let _isFromElIframe = false;\n\n  if (!(_from instanceof Element)) {\n    if (_from === \"activeElement\") {\n      const activeElement = document.activeElement!;\n      _isFromElIframe = isIframe(activeElement);\n      fromResult = getActiveElement(activeElement);\n    }\n    if (typeof _from === \"object\") {\n      if (_from.getActiveElement) {\n        fromResult = getActiveElement(_from.el);\n      }\n      _isFromElIframe = _from.isIframe;\n    }\n  } else {\n    _isFromElIframe = isIframe(_from);\n    fromResult = _from;\n  }\n\n  const from = fromResult;\n  const parent = from.parentElement!;\n  const isFromElIframe = _isFromElIframe;\n  const visitedElement = from;\n  const tabbableSelectors =\n    _tabbableSelectors + (allowSelectors ? \",\" + allowSelectors.join(\",\") : \"\");\n\n  if (!visitedElement) return null;\n\n  const traverseNextSiblingsThenUp = (\n    parent: Element,\n    visitedElement: Element\n  ): HTMLElement | null => {\n    let hasPassedVisitedElement = false;\n\n    const children = parent.children;\n    const childrenCount = children.length;\n\n    if (willWrap) {\n      hasPassedVisitedElement = true;\n    }\n\n    if (direction === \"forwards\") {\n      for (let i = 0; i < childrenCount; i++) {\n        const child = children[i];\n\n        if (hasPassedVisitedElement) {\n          const el = queryTabbableElement(\n            child,\n            tabbableSelectors,\n            direction,\n            ignoreElement\n          );\n\n          if (el) {\n            return el as HTMLElement;\n          }\n          continue;\n        }\n        if (child === stopAtRootElement) {\n          return null;\n        }\n        if (child === visitedElement) {\n          hasPassedVisitedElement = true;\n          continue;\n        }\n      }\n    } else {\n      for (let i = childrenCount - 1; i >= 0; i--) {\n        const child = children[i];\n\n        if (hasPassedVisitedElement) {\n          const el = queryTabbableElement(\n            child,\n            tabbableSelectors,\n            direction,\n            ignoreElement\n          );\n          if (el) return el as HTMLElement;\n          continue;\n        }\n        if (child === stopAtRootElement) {\n          return null;\n        }\n        if (child === visitedElement) {\n          hasPassedVisitedElement = true;\n          continue;\n        }\n      }\n    }\n\n    visitedElement = parent;\n    parent = parent.parentElement!;\n\n    if (!parent && isFromElIframe) {\n      // TODO: only get's top level iframe, should get correct iframe\n      const iframe = document.activeElement;\n\n      if (iframe && isIframe(iframe)) {\n        visitedElement = iframe;\n        parent = iframe.parentElement!;\n      }\n    }\n\n    if (!parent) {\n      return null;\n    }\n\n    return traverseNextSiblingsThenUp(parent, visitedElement);\n  };\n\n  let result = traverseNextSiblingsThenUp(parent, visitedElement);\n\n  if (!result && wrap && stopAtRootElement) {\n    willWrap = true;\n    originalFrom = from as HTMLElement;\n    result = getNextTabbableElement({\n      from: stopAtRootElement,\n      allowSelectors,\n      direction,\n      ignoreElement,\n      // stopAtElement,\n      wrap: false,\n    }) as HTMLElement | null;\n  }\n  willWrap = false;\n  originalFrom = null;\n\n  return result;\n};\n\nconst getIframeWindow = (iframe: HTMLIFrameElement) => {\n  try {\n    return iframe.contentWindow;\n  } catch (e) {\n    return null;\n  }\n};\n\nconst getIframeDocument = (iframe: HTMLIFrameElement) => {\n  const iframeWindow = getIframeWindow(\n    iframe as HTMLIFrameElement\n  ) as unknown as Window;\n\n  if (!iframeWindow) return null;\n\n  return iframeWindow.document as Document | null;\n};\n\nconst getActiveElement = (el: Element) => {\n  // TODO: only goes one depth, should go infinitly\n  if (!isIframe(el)) return el;\n  const iframeDocument = getIframeDocument(el as HTMLIFrameElement);\n  if (!iframeDocument) return el;\n\n  return iframeDocument.activeElement || el;\n};\n\nconst isHidden = (el: HTMLElement, windowContext: Window = window) => {\n  const checkByStyle = (style: CSSStyleDeclaration) =>\n    style.display === \"none\" || style.visibility === \"hidden\";\n\n  if ((el.style && checkByStyle(el.style)) || el.hidden) return true;\n\n  const style = windowContext.getComputedStyle(el);\n  if (!style || checkByStyle(style)) return true;\n\n  return false;\n};\n\nexport const queryTabbableElement = (\n  el: Element,\n  selectors: string = _tabbableSelectors,\n  iterationDirection: \"forwards\" | \"backwards\" = \"forwards\",\n  ignoreElement: HTMLElement[] = [],\n  windowContext: Window = window,\n  init: boolean = true\n): HTMLElement | null => {\n  const queryChild = (\n    el: Element\n  ): { el: Element; matched: boolean; windowContext?: Window } => {\n    if (!el.matches(selectors))\n      return {\n        el,\n        matched: false,\n      };\n\n    const tabindex = el.getAttribute(\"tabindex\");\n    if (isIframe(el) && (!tabindex || tabindex === \"-1\")) {\n      const iframeWindow = getIframeWindow(\n        el as HTMLIFrameElement\n      ) as unknown as Window;\n      if (!iframeWindow) {\n        return { el, matched: true };\n      }\n      el = iframeWindow.document.documentElement;\n      windowContext = iframeWindow;\n\n      return { el, matched: false, windowContext: iframeWindow };\n    }\n\n    return {\n      el,\n      matched: true,\n    };\n  };\n\n  if (init) {\n    if (\n      ignoreElement.some((item) => item === el) ||\n      isHidden(el as HTMLElement, windowContext)\n    )\n      return null;\n\n    const {\n      el: elResult,\n      matched,\n      windowContext: windowContextResult,\n    } = queryChild(el);\n    el = elResult;\n    if (matched) return el as HTMLElement;\n    windowContext = windowContextResult || windowContext;\n\n    return queryTabbableElement(\n      el,\n      selectors,\n      iterationDirection,\n      ignoreElement,\n      windowContext,\n      false\n    );\n  }\n\n  const shadowRoot = el.shadowRoot;\n  if (shadowRoot) el = shadowRoot as unknown as Element;\n\n  const children = el.children;\n  const childrenLength = children.length;\n\n  const iterateChild = (\n    el: Element\n  ): { returnVal?: Element; continue?: boolean } | null => {\n    if (\n      ignoreElement.some((item) => item === el) ||\n      isHidden(el as HTMLElement, windowContext)\n    )\n      return {\n        continue: true,\n      };\n\n    const {\n      el: elResult,\n      matched,\n      windowContext: windowContextResult,\n    } = queryChild(el);\n\n    el = elResult;\n    windowContext = windowContextResult || windowContext;\n\n    if (matched) {\n      return { returnVal: el };\n    }\n\n    const foundChild = queryTabbableElement(\n      el,\n      selectors,\n      iterationDirection,\n      ignoreElement,\n      windowContext,\n      false\n    );\n    if (foundChild) return { returnVal: foundChild };\n\n    return null;\n  };\n\n  if (iterationDirection === \"forwards\") {\n    for (let i = 0; i < childrenLength; i++) {\n      let child = children[i];\n      const result = iterateChild(child);\n\n      if (result) {\n        if (result.continue) continue;\n        if (result.returnVal) return result.returnVal as HTMLElement;\n      }\n    }\n  } else {\n    for (let i = childrenLength - 1; i >= 0; i--) {\n      let child = children[i];\n      const result = iterateChild(child);\n\n      if (result) {\n        if (result.continue) continue;\n        if (result.returnVal) return result.returnVal as HTMLElement;\n      }\n    }\n  }\n\n  return null;\n};\n\nconst isIframe = (el: Element) => el.tagName === \"IFRAME\";\n","/**\n * Why this might be better than direct check of CSS display property? Because you do not need to check all parent elements. If some parent element has display: none, its children are hidden too but still has `element.style.display !== 'none'`\n */\nexport const hasDisplayNone = (el: HTMLElement) =>\n  el.offsetHeight === 0 && el.offsetWidth === 0;\n","export const isObjectLiteral = <T>(value: T) =>\n  Object.getPrototypeOf(value) === Object.prototype;\n","import { TLocalState } from \"../local/localState\";\nimport { getMenuButton } from \"../local/menuButton\";\nimport { isObjectLiteral } from \"./isObjectLiteral\";\nimport { getNextTabbableElement } from \"./tabbing\";\n\nexport const queryElement = (\n  state: Partial<TLocalState>,\n  {\n    inputElement,\n    type,\n    subType,\n  }: {\n    /**\n     * `\"menuPopup\"` | `\"menuButton\"` | `any`\n     */\n    inputElement: any;\n    type?:\n      | \"menuButton\"\n      | \"menuPopup\"\n      | \"closeButton\"\n      | \"focusElementOnClose\"\n      | \"focusElementOnOpen\";\n    subType?:\n      | \"tabForwards\"\n      | \"tabBackwards\"\n      | \"click\"\n      | \"escapeKey\"\n      | \"scrolling\";\n  }\n): HTMLElement => {\n  if (inputElement === \"menuPopup\") {\n    return state.menuPopupEl!;\n  }\n  if (inputElement === \"menuButton\") {\n    return getMenuButton(state.menuBtnEls!);\n  }\n  if (type === \"focusElementOnOpen\") {\n    if (isObjectLiteral(inputElement)) {\n      return queryElement(state, {\n        inputElement: inputElement.target,\n        type: \"focusElementOnOpen\",\n      });\n    }\n    if (inputElement === \"none\") return null as any;\n    if (inputElement === \"firstChild\") {\n      return getNextTabbableElement({\n        from: state.focusSentinelBeforeEl!,\n        stopAtRootElement: state.containerEl!,\n      })!;\n    }\n    if (typeof inputElement === \"string\") {\n      return state.containerEl?.querySelector(inputElement) as HTMLElement;\n    }\n    if (inputElement instanceof Element) {\n      return inputElement as HTMLElement;\n    }\n    if (typeof inputElement === \"object\") {\n      return queryElement(state, {\n        inputElement: inputElement.target,\n        type: \"focusElementOnOpen\",\n      });\n    }\n    const component = inputElement();\n    if (typeof component === \"string\") {\n      return state.containerEl?.querySelector(component) as HTMLElement;\n    }\n    return component;\n  }\n  if (inputElement == null && type === \"menuPopup\") {\n    if (!state.containerEl) return null as any;\n    if (state.menuPopupEl) return state.menuPopupEl;\n    return state.containerEl.children[1] as HTMLElement;\n  }\n  if (typeof inputElement === \"string\" && type === \"menuButton\") {\n    return document.querySelector(inputElement) as HTMLElement;\n  }\n  if (typeof inputElement === \"string\") {\n    return document.querySelector(inputElement) as HTMLElement;\n  }\n  if (inputElement instanceof Element) {\n    return inputElement as HTMLElement;\n  }\n\n  if (typeof inputElement === \"function\") {\n    const result = inputElement();\n    if (result instanceof Element) {\n      return result as HTMLElement;\n    }\n    if (type === \"closeButton\") {\n      if (!state.containerEl) return null as any;\n      return state.containerEl.querySelector(result) as HTMLElement;\n    }\n  }\n\n  if (type === \"focusElementOnClose\") {\n    if (!inputElement) return null as any;\n\n    switch (subType) {\n      case \"tabForwards\":\n        return queryElement(state, { inputElement: inputElement.tabForwards });\n      case \"tabBackwards\":\n        return queryElement(state, { inputElement: inputElement.tabBackwards });\n      case \"click\":\n        return queryElement(state, { inputElement: inputElement.click });\n      case \"escapeKey\":\n        return queryElement(state, { inputElement: inputElement.escapeKey });\n      case \"scrolling\":\n        return queryElement(state, { inputElement: inputElement.scrolling });\n    }\n  }\n\n  if (inputElement == null) return null as any;\n\n  if (Array.isArray(inputElement)) {\n    return inputElement.map((el) =>\n      queryElement(state, { inputElement: el, type })\n    ) as any;\n  }\n\n  for (const key in inputElement as { [key: string]: any }) {\n    const item = (inputElement as { [key: string]: any })[key];\n    return queryElement(state, { inputElement: item });\n  }\n\n  return null as any;\n};\n","import { hasDisplayNone } from \"./hasDisplayNone\";\n\n/**\n * checks if element is hidden or invisible\n *\n * The shallow checking is whether element has css `visibility: hidden` property\n */\nconst isHiddenOrInvisbleShallow = (el: HTMLElement) => {\n  const isInvisible = (el: HTMLElement) => {\n    const checkByStyle = (style: CSSStyleDeclaration) =>\n      style.visibility === \"hidden\";\n\n    if ((el.style && checkByStyle(el.style)) || el.hidden) return true;\n\n    const style = window.getComputedStyle(el);\n    if (!style || checkByStyle(style)) return true;\n\n    return false;\n  };\n  return hasDisplayNone(el) || isInvisible(el);\n};\n\nexport default isHiddenOrInvisbleShallow;\n","/**\n *  Iterate stack backwards, checks item, pass it to close callback. Setting `continue` to `true` property in checkCb return object, will continue iteration\n */\nexport const checkThenClose = <T extends unknown>(\n  arr: T[],\n  checkCb: (item: T) => { item?: T; continue: boolean },\n  destroyCb: (item: T) => void\n) => {\n  for (let i = arr.length - 1; i >= 0; i--) {\n    const { item, continue: _continue } = checkCb(arr[i]);\n\n    if (item) {\n      destroyCb(item);\n    }\n\n    if (_continue) continue;\n\n    return;\n  }\n};\n","import { dismissStack } from \"../global/dismissStack\";\nimport {\n  globalState,\n  onKeyDownFocusIn,\n  runLastAfterEvents,\n} from \"../global/globalEvents\";\nimport { TLocalState } from \"./localState\";\nimport { getNextTabbableElement } from \"../utils/tabbing\";\nimport { hasDisplayNone } from \"../utils/hasDisplayNone\";\nimport { queryElement } from \"../utils/queryElement\";\nimport { TDismiss } from \"..\";\nimport isHiddenOrInvisbleShallow from \"../utils/isHiddenOrInvisibleShallow\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\n\nexport const onClickMenuButton = (state: TLocalState, e: Event) => {\n  const {\n    timeouts,\n    closeWhenMenuButtonIsClicked,\n    focusedMenuBtn,\n    onClickOutsideMenuButtonRef: onClickOutsideRef,\n    setOpen,\n    open,\n    deadMenuButton,\n    closeWhenClickingOutside,\n  } = state;\n\n  state.menuBtnMouseDownFired = false;\n\n  const menuBtnEl = e.currentTarget as HTMLElement;\n\n  globalState.focusedMenuBtns.forEach((item) => (item.el = null));\n\n  if (deadMenuButton) {\n    // globalState.addedDocumentClick = true;\n    // setTimeout(() => {\n    //   document.addEventListener(\"pointerdown\", onDocumentClick, { once: true });\n    // });\n    return;\n  }\n\n  state.menuBtnKeyupTabFired = false;\n\n  focusedMenuBtn.el = menuBtnEl;\n  globalState.focusedMenuBtns.add(focusedMenuBtn);\n  // TODO:?\n  // timeouts.containerFocusTimeoutId = null;\n\n  if (!closeWhenClickingOutside) {\n    const stackItem = dismissStack[dismissStack.length - 1];\n    if (\n      stackItem &&\n      !stackItem.menuBtnEls.includes(menuBtnEl) &&\n      !stackItem.containerEl.contains(menuBtnEl)\n    ) {\n      checkThenClose(\n        dismissStack,\n        (item) => {\n          return { item, continue: true };\n        },\n        (item) => {\n          const { setOpen } = item;\n          setOpen(false);\n        }\n      );\n    }\n  }\n\n  if (!closeWhenMenuButtonIsClicked) {\n    setOpen(true);\n    return;\n  }\n\n  if (open()) {\n    // focusedMenuBtn.el = null;\n    globalState.closedByEvents = true;\n  }\n\n  setOpen(!open());\n};\n\nexport const onBlurMenuButton = (state: TLocalState, e: FocusEvent) => {\n  const {\n    containerEl,\n    focusedMenuBtn,\n    overlay,\n    setOpen,\n    timeouts,\n    menuBtnMouseDownFired,\n    closeWhenDocumentBlurs,\n    closeWhenClickingOutside,\n\n    open,\n  } = state;\n  const currentMenuBtn = e.currentTarget as HTMLButtonElement;\n\n  queueMicrotask(() => {\n    runLastAfterEvents();\n  });\n\n  if (state.menuBtnKeyupTabFired) {\n    state.menuBtnKeyupTabFired = false;\n    return;\n  }\n\n  if (menuBtnMouseDownFired) return;\n  if (containerEl && containerEl.contains(e.relatedTarget as HTMLElement))\n    return;\n\n  if (!closeWhenClickingOutside && open()) {\n    document.addEventListener(\"keydown\", onKeyDownFocusIn);\n    return;\n  }\n\n  const clickedTarget = globalState.clickTarget;\n\n  const run = () => {\n    const activeElement = document.activeElement;\n\n    if (\n      (!e.relatedTarget && activeElement && activeElement.tagName === \"IFRAME\",\n      containerEl && containerEl.contains(activeElement))\n    )\n      return;\n    if (!closeWhenDocumentBlurs && !document.hasFocus()) return;\n    if (globalState.closedBySetOpen) return;\n    if (!currentMenuBtn.isConnected) return;\n    if (isHiddenOrInvisbleShallow(currentMenuBtn)) {\n      let clickIsOutside = false;\n      state.menuBtnEls?.some((el) => {\n        if (el === currentMenuBtn) return false;\n        if (isHiddenOrInvisbleShallow(el)) return false;\n        if (clickedTarget && !el.contains(clickedTarget)) {\n          clickIsOutside = true;\n          return false;\n        }\n\n        el.focus();\n        return true;\n      });\n      if (!clickIsOutside) {\n        return;\n      }\n    }\n\n    if (!state.open()) return;\n\n    globalState.closedByEvents = true;\n    // TODO:?\n    focusedMenuBtn.el = null;\n\n    setOpen(false);\n  };\n\n  timeouts.menuButtonBlurTimeoutId = window.setTimeout(run);\n};\n\nexport const onMouseDownMenuButton = (state: TLocalState, e: MouseEvent) => {\n  const { focusMenuButtonOnMouseDown } = state;\n  const menuBtnEl = e.currentTarget as HTMLElement;\n\n  state.menuBtnMouseDownFired = true;\n  menuBtnEl.addEventListener(\"click\", state.onClickMenuButtonRef);\n\n  // if `false`, enables switching focus from menuButton to menuPopup input element while keeping virtual keyboard opened in iOS. However end-user must also provide additional logic to fire inside menuButton onclick for behavior to work.\n  if (focusMenuButtonOnMouseDown) {\n    menuBtnEl.addEventListener(\"blur\", state.onBlurMenuButtonRef);\n    requestAnimationFrame(() => {\n      menuBtnEl.focus();\n    });\n  }\n};\n\n// TODO: ?\nexport const onClickOutsideMenuButton = (state: TLocalState) => {\n  state.focusedMenuBtn.el = null;\n};\n\nexport const onKeydownMenuButton = (state: TLocalState, e: KeyboardEvent) => {\n  const {\n    containerEl,\n    setOpen,\n    open,\n    onKeydownMenuButtonRef,\n    onBlurMenuButtonRef,\n    mount,\n    focusSentinelBeforeEl,\n    focusSentinelAfterEl,\n    ignoreMenuPopupWhenTabbing,\n  } = state;\n\n  const menuBtnEl = e.currentTarget as HTMLElement;\n\n  if (e.key !== \"Tab\") return;\n\n  globalState.focusedMenuBtns.forEach((item) => (item.el = null));\n\n  if (!open()) return;\n\n  state.menuBtnKeyupTabFired = true;\n\n  if (e.key === \"Tab\" && e.shiftKey) {\n    globalState.closedByEvents = true;\n    // menuPopup is previous general sibling of menuButton\n    if (!mount || menuBtnEl!.nextElementSibling !== containerEl) {\n      e.preventDefault();\n\n      let el = getNextTabbableElement({\n        from: menuBtnEl!,\n        direction: \"backwards\",\n        ignoreElement: [\n          containerEl!,\n          focusSentinelBeforeEl!,\n          focusSentinelAfterEl!,\n        ],\n      });\n\n      if (el) {\n        el.focus();\n      }\n    }\n\n    setOpen(false);\n    menuBtnEl!.removeEventListener(\"keydown\", onKeydownMenuButtonRef);\n    menuBtnEl!.removeEventListener(\"blur\", onBlurMenuButtonRef);\n    return;\n  }\n\n  e.preventDefault();\n\n  if (ignoreMenuPopupWhenTabbing) {\n    const el = getNextTabbableElement({\n      from: menuBtnEl!,\n      direction: \"forwards\",\n      ignoreElement: [\n        containerEl!,\n        focusSentinelBeforeEl!,\n        focusSentinelAfterEl!,\n      ],\n    });\n    if (el) {\n      el.focus();\n    }\n    setOpen(false);\n    menuBtnEl!.removeEventListener(\"keydown\", onKeydownMenuButtonRef);\n    menuBtnEl!.removeEventListener(\"blur\", onBlurMenuButtonRef);\n    return;\n  }\n\n  let el = getNextTabbableElement({\n    from: focusSentinelBeforeEl!,\n    stopAtRootElement: containerEl,\n  });\n\n  if (el) {\n    el.focus();\n  } else {\n    // TODO: why is this needed when next conditional queries element and focuses it\n    containerEl!.focus();\n  }\n\n  if (!el) {\n    setOpen(false);\n\n    el = getNextTabbableElement({\n      from: focusSentinelBeforeEl!,\n    });\n\n    if (el) {\n      el.focus();\n    }\n  }\n\n  menuBtnEl!.removeEventListener(\"keydown\", onKeydownMenuButtonRef);\n  menuBtnEl!.removeEventListener(\"blur\", onBlurMenuButtonRef);\n};\n\nexport const onFocusMenuButton = (state: TLocalState, e: Event) => {\n  const {\n    closeWhenMenuButtonIsTabbed,\n    timeouts,\n    deadMenuButton,\n    menuBtnEls,\n    focusedMenuBtn,\n  } = state;\n\n  const menuBtn = getMenuButton(menuBtnEls!);\n  menuBtn.addEventListener(\"click\", state.onClickMenuButtonRef);\n  menuBtn.addEventListener(\"blur\", state.onBlurMenuButtonRef);\n  menuBtn.addEventListener(\"keydown\", state.onKeydownMenuButtonRef);\n  focusedMenuBtn.el = e.currentTarget as HTMLButtonElement;\n\n  // solution to Safari/Mac/iOS\n\n  window.setTimeout(() => {\n    // check if menuButton arg is an array of at least two items(buttons)\n    // check if currentTarget focused\n    // if yes, check if it's hidden\n    // if yes, mark a variable\n    // then on blur event, if that variable is true\n    // if yes, check if currentTarget is hidden\n    // then allow blur to continue and close stacks, rather than focus on other button bug\n    // if()\n  });\n\n  // TODO:\n  if (deadMenuButton) {\n    menuBtn.addEventListener(\"blur\", state.onBlurMenuButtonRef);\n    menuBtn.addEventListener(\"keydown\", state.onKeydownMenuButtonRef);\n\n    // globalState.addedDocumentClick = true;\n    // setTimeout(() => {\n    //   document.addEventListener(\"pointerdown\", onDocumentClick, { once: true });\n    // });\n    return;\n  }\n\n  if (!closeWhenMenuButtonIsTabbed) {\n    clearTimeout(timeouts.containerFocusTimeoutId!);\n  }\n};\n\nexport const getMenuButton = (menuBtnEls: HTMLElement[]): HTMLElement => {\n  if (!menuBtnEls) return undefined as any;\n\n  if (menuBtnEls.length <= 1) return menuBtnEls[0];\n\n  return menuBtnEls.find((menuBtnEl) => {\n    if (!menuBtnEl || hasDisplayNone(menuBtnEl)) return;\n\n    return menuBtnEl;\n  })!;\n};\n\nexport const markFocusedMenuButton = ({\n  focusedMenuBtn,\n  timeouts,\n  el,\n}: {\n  el: HTMLElement;\n} & Pick<TLocalState, \"focusedMenuBtn\" | \"timeouts\">) => {\n  focusedMenuBtn.el = el;\n\n  el.addEventListener(\n    \"blur\",\n    (e) => {\n      const el = e.currentTarget as HTMLElement;\n\n      globalState.focusedMenuBtns.add(focusedMenuBtn);\n\n      setTimeout(() => {\n        if (!el.isConnected) return;\n\n        focusedMenuBtn.el = null;\n      });\n    },\n    {\n      once: true,\n    }\n  );\n};\n\nexport const addMenuButtonEventsAndAttributes = ({\n  state,\n  menuButton,\n  open,\n}: {\n  state: TLocalState;\n  menuButton: TDismiss[\"menuButton\"];\n  open: () => boolean;\n}) => {\n  if (Array.isArray(menuButton) && !menuButton.length) return;\n\n  const { focusedMenuBtn, containerEl } = state;\n  const menuBtnEls = queryElement(state, {\n    inputElement: menuButton,\n    type: \"menuButton\",\n  }) as unknown as HTMLElement[];\n\n  if (!menuBtnEls) {\n    return;\n  }\n\n  state.menuBtnEls = Array.isArray(menuBtnEls) ? menuBtnEls : [menuBtnEls];\n\n  const item = dismissStack.find((item) => item.uniqueId === state.uniqueId);\n  if (item) {\n    item.menuBtnEls = state.menuBtnEls;\n  }\n\n  // if (state.deadMenuButton) {\n  //   // deadMenuButton doesn't do anything, why is this here\n  //   state.menuBtnEls.forEach((menuBtnEl) => {\n  //     menuBtnEl.addEventListener(\"click\", state.onClickMenuButtonRef);\n  //     menuBtnEl.addEventListener(\"mousedown\", state.onMouseDownMenuButtonRef);\n  //     menuBtnEl.addEventListener(\"focus\", state.onFocusMenuButtonRef);\n  //     // menuBtnEl.addEventListener(\"blur\", state.onBlurMenuButtonRef);\n  //   });\n  //   return;\n  // }\n\n  state.menuBtnEls.forEach((menuBtnEl, _, self) => {\n    addAriaLabels(state, menuBtnEl);\n    // menuBtnEl.removeAttribute(\"type\");\n    // menuBtnEl.setAttribute(\"role\", 'div');\n    // menuBtnEl.setAttribute(\"tabindex\", 'div');\n    menuBtnEl.addEventListener(\"mousedown\", state.onMouseDownMenuButtonRef);\n    menuBtnEl.addEventListener(\"focus\", state.onFocusMenuButtonRef);\n    if (\n      focusedMenuBtn.el &&\n      focusedMenuBtn.el !== menuBtnEl &&\n      (self.length > 1 ? !hasDisplayNone(menuBtnEl) : true)\n    ) {\n      focusedMenuBtn.el = menuBtnEl;\n\n      // TODO: will fail on other stacks\n      if (containerEl && containerEl.contains(document.activeElement)) return;\n\n      menuBtnEl.focus({ preventScroll: true });\n      // TODO:?\n      // menuBtnEl!.addEventListener(\"keydown\", state.onKeydownMenuButtonRef);\n    }\n  });\n};\n\nconst addAriaLabels = (state: TLocalState, targetEl: HTMLElement) => {\n  const { modal, uniqueId, deadMenuButton } = state;\n  // TODO: maybe just get rid of adding attributes at runtime and tell users to add it themselves\n  if (!deadMenuButton) {\n    if (targetEl.hasAttribute(\"type\")) return;\n    targetEl.setAttribute(\"type\", \"button\");\n    targetEl.setAttribute(\"aria-expanded\", \"false\");\n  }\n\n  if (modal) {\n    targetEl.setAttribute(\"aria-controls\", uniqueId);\n    targetEl.setAttribute(\"aria-haspopup\", \"dialog\");\n  }\n};\n\nexport const setTargetAriaExpandTrue = (state: TLocalState) => {\n  const { menuBtnEls, deadMenuButton } = state;\n  if (!deadMenuButton) return;\n  if (!menuBtnEls) return;\n  menuBtnEls.forEach((el) => {\n    el.setAttribute(\"aria-expanded\", \"true\");\n  });\n};\nexport const setTargetAriaExpandFalse = (state: TLocalState) => {\n  const { menuBtnEls, deadMenuButton } = state;\n  if (!deadMenuButton) return;\n  if (!menuBtnEls) return;\n  menuBtnEls.forEach((el) => {\n    el.setAttribute(\"aria-expanded\", \"false\");\n  });\n};\n\nexport const removeMenuButtonEvents = (\n  state: TLocalState,\n  isCleanup?: boolean\n) => {\n  if (!state || !state.menuBtnEls) return;\n\n  state.menuBtnMouseDownFired = false;\n\n  state.menuBtnEls.forEach((menuBtnEl) => {\n    if (isCleanup) {\n      menuBtnEl.removeEventListener(\"blur\", state.onBlurMenuButtonRef);\n      menuBtnEl.removeEventListener(\"keydown\", state.onKeydownMenuButtonRef);\n\n      menuBtnEl.removeEventListener(\"click\", state.onClickMenuButtonRef);\n      menuBtnEl.removeEventListener(\"focus\", state.onFocusMenuButtonRef);\n      menuBtnEl.removeEventListener(\n        \"mousedown\",\n        state.onMouseDownMenuButtonRef\n      );\n    }\n  });\n};\n","import { dismissStack } from \"../global/dismissStack\";\nimport { globalState } from \"../global/globalEvents\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\nimport isHiddenOrInvisbleShallow from \"../utils/isHiddenOrInvisibleShallow\";\n\nexport const getActiveMountedPopupFromSafeList = (safeList: string[]) => {\n  if (globalState.thirdPartyPopupEl) {\n    globalState.thirdPartyPopupEl = null;\n    return null;\n  }\n  if (!document.hasFocus()) return null;\n\n  const activeElement = globalState.clickTarget;\n  const els = safeList.map(\n    (selector) => document.querySelector(selector) as HTMLElement\n  );\n\n  const foundEl = els.find((el) => el && el.contains(activeElement)) || null;\n  globalState.thirdPartyPopupEl = foundEl;\n  return foundEl;\n};\n\nexport const getFirstVisibleMountedPopupFromSafeList = (safeList: string[]) => {\n  for (let selector of safeList) {\n    const el = document.querySelector(selector) as HTMLElement;\n    if (el && !isHiddenOrInvisbleShallow(el)) return el;\n  }\n  return null;\n};\n\nexport const addEventsToActiveMountedPopup = () => {\n  document.addEventListener(\"click\", onClickDocument);\n  document.addEventListener(\"keydown\", onKeyDown, { capture: true });\n};\n\nexport const removeEventsOnActiveMountedPopup = () => {\n  document.removeEventListener(\"click\", onClickDocument);\n  document.removeEventListener(\"keydown\", onKeyDown, { capture: true });\n  globalState.thirdPartyPopupEl = null;\n  globalState.thirdPartyPopupElPressedEscape = false;\n};\n\nconst onClickDocument = (e: MouseEvent) => {\n  const target = e.target as HTMLElement;\n  const { thirdPartyPopupEl } = globalState;\n  if (thirdPartyPopupEl && thirdPartyPopupEl.contains(target)) {\n    return;\n  }\n\n  checkThenClose(\n    dismissStack,\n    (item) => {\n      const { containerEl } = item;\n      if (containerEl.contains(target)) return { continue: false };\n      return { item, continue: true };\n    },\n    (item) => {\n      const { setOpen } = item;\n      globalState.closedByEvents = true;\n      setOpen(false);\n      removeEventsOnActiveMountedPopup();\n    }\n  );\n};\n\nconst onKeyDown = (e: KeyboardEvent) => {\n  if (e.key !== \"Escape\") return;\n  globalState.thirdPartyPopupElPressedEscape = true;\n};\n","import { dismissStack, TDismissStack } from \"./dismissStack\";\nimport { getMenuButton } from \"../local/menuButton\";\nimport { getNextTabbableElement } from \"../utils/tabbing\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\nimport { queryElement } from \"../utils/queryElement\";\nimport {\n  getFirstVisibleMountedPopupFromSafeList,\n  removeEventsOnActiveMountedPopup,\n} from \"../local/thirdPartyPopup\";\nimport isHiddenOrInvisbleShallow from \"../utils/isHiddenOrInvisibleShallow\";\n\nlet scrollEventAddedViaTouch = false;\nlet scrollEventAdded = false;\nlet pollTimeoutId: number | null = null;\nlet timestampOfTabkey: number = 0;\nlet cachedScrollTarget: Element | null = null;\nlet cachedPolledElement: Element | null = null;\n\nexport const globalState: {\n  closeByFocusSentinel: boolean;\n  closedBySetOpen: boolean;\n  documentClickTimeout: number | null;\n  menuBtnEl?: HTMLElement | null;\n  focusedMenuBtns: Set<{ el: HTMLElement | null }>;\n  closedByEvents: boolean;\n  cursorKeysPrevEl: HTMLElement | null;\n  clickTarget: HTMLElement | null;\n  overlayMouseDown: boolean;\n  thirdPartyPopupEl: HTMLElement | null;\n  thirdPartyPopupElPressedEscape: boolean;\n} = {\n  closeByFocusSentinel: false,\n  closedBySetOpen: false,\n  documentClickTimeout: null,\n  closedByEvents: false,\n  focusedMenuBtns: new Set(),\n  cursorKeysPrevEl: null,\n  clickTarget: null,\n  overlayMouseDown: false,\n  thirdPartyPopupEl: null,\n  thirdPartyPopupElPressedEscape: false,\n};\n\nlet runLastAfterEventsTimerId = null as any as number;\nexport const runLastAfterEvents = () => {\n  clearTimeout(runLastAfterEventsTimerId);\n\n  runLastAfterEventsTimerId = window.setTimeout(() => {\n    globalState.clickTarget = null;\n  });\n};\n\nexport const onDocumentPointerUp = () => {\n  // clearing clickTarget inside pointerup event doesn't work because the focusout events fire many tasks later. In Desktop pointerup is fine, in Chrome mobile it fires a few tasks later, in iOS it fires many many tasks later.\n  // so instead its cleared inside debounced focusout callback\n  // globalState.clickTarget = null;\n  // runLastAfterEvents()\n  document.removeEventListener(\"pointerup\", onDocumentPointerUp);\n};\n\nexport const onDocumentPointerDown = (e: Event) => {\n  const target = e.target as HTMLElement;\n\n  globalState.clickTarget = target;\n  document.addEventListener(\"pointerup\", onDocumentPointerUp);\n};\n\nexport const onWindowBlur = (e: Event) => {\n  const item = dismissStack[dismissStack.length - 1];\n\n  // menuPopup item was the last tabbable item in the document and current focused item is outside of document, such as browser URL bar, then menuPopup/stacks will close\n  setTimeout(() => {\n    const difference = e.timeStamp - timestampOfTabkey;\n    if (!document.hasFocus()) {\n      if (difference < 50) {\n        checkThenClose(\n          dismissStack,\n          (item) => ({ item, continue: true }),\n          (item) => {\n            const { setOpen } = item;\n            globalState.closedByEvents = true;\n            setOpen(false);\n          }\n        );\n        return;\n      }\n    }\n  });\n\n  const onBlurWindow = (item: TDismissStack) => {\n    if (item.overlay || item.overlayEl) return;\n    if (!item.closeWhenDocumentBlurs) return;\n    const menuBtnEl = getMenuButton(item.menuBtnEls);\n    menuBtnEl.focus();\n    globalState.closedByEvents = true;\n    item.setOpen(false);\n  };\n\n  if (item.overlay) return;\n\n  setTimeout(() => {\n    const activeElement = document.activeElement;\n\n    if (!activeElement || activeElement.tagName !== \"IFRAME\") {\n      checkThenClose(\n        dismissStack,\n        (item) => ({ item, continue: true }),\n        (item) => onBlurWindow(item)\n      );\n      return;\n    }\n\n    checkThenClose(\n      dismissStack,\n      (item) => {\n        const { containerEl } = item;\n\n        if (containerEl.contains(activeElement)) {\n          cachedPolledElement = activeElement;\n\n          pollingIframe();\n\n          document.addEventListener(\"visibilitychange\", onVisibilityChange);\n          return { continue: false };\n        }\n\n        return { item, continue: true };\n      },\n      (item) => {\n        const { setOpen } = item;\n        globalState.closedByEvents = true;\n        setOpen(false);\n      }\n    );\n  });\n};\n\nexport const onKeyDownFocusIn = (e: KeyboardEvent) => {\n  if (e.key !== \"Tab\") return;\n\n  setTimeout(() => {\n    const activeElement = document.activeElement as HTMLElement;\n\n    const stackItem = dismissStack[0];\n\n    document.removeEventListener(\"keydown\", onKeyDownFocusIn);\n\n    if (\n      stackItem &&\n      !stackItem.menuBtnEls.some((el) => el && el.contains(activeElement))\n    ) {\n      checkThenClose(\n        dismissStack,\n        (item) => ({ item, continue: true }),\n        (item) => {\n          const { setOpen } = item;\n          // globalState.closedByEvents = true;\n          setOpen(false);\n        }\n      );\n    }\n  });\n};\n\nexport const onKeyDown = (e: KeyboardEvent) => {\n  const {\n    setOpen,\n    menuBtnEls,\n    cursorKeys,\n    closeWhenEscapeKeyIsPressed,\n    focusElementOnClose,\n    ignoreMenuPopupWhenTabbing,\n    focusSentinelAfterEl,\n    focusSentinelBeforeEl,\n    mountedPopupsSafeList,\n  } = dismissStack[dismissStack.length - 1];\n\n  if (e.key === \"Tab\") {\n    if (ignoreMenuPopupWhenTabbing) {\n      e.preventDefault();\n      const shiftKey = e.shiftKey;\n      // TODO: work with stacks?\n      const menuBtnEl = getMenuButton(menuBtnEls);\n\n      const el = getNextTabbableElement({\n        from: shiftKey ? focusSentinelBeforeEl! : focusSentinelAfterEl!,\n        direction: shiftKey ? \"backwards\" : \"forwards\",\n        ignoreElement: menuBtnEl ? [menuBtnEl] : [],\n      });\n\n      if (el) {\n        el.focus();\n      }\n      return;\n    }\n    timestampOfTabkey = e.timeStamp;\n  }\n\n  if (cursorKeys) {\n    onCursorKeys(e);\n  }\n\n  if (e.key !== \"Escape\" || !closeWhenEscapeKeyIsPressed) return;\n\n  if (globalState.thirdPartyPopupElPressedEscape) {\n    globalState.thirdPartyPopupElPressedEscape = false;\n    removeEventsOnActiveMountedPopup();\n    return;\n  }\n\n  if (mountedPopupsSafeList && mountedPopupsSafeList.length) {\n    const el = getFirstVisibleMountedPopupFromSafeList(mountedPopupsSafeList);\n    if (el) {\n      window.setTimeout(() => {\n        if (!el.isConnected || isHiddenOrInvisbleShallow(el)) return;\n        close();\n      }, 100);\n      return;\n    }\n  }\n\n  function close() {\n    const menuBtnEl = getMenuButton(menuBtnEls);\n\n    const el =\n      queryElement(\n        {},\n        {\n          inputElement: focusElementOnClose,\n          type: \"focusElementOnClose\",\n          subType: \"escapeKey\",\n        }\n      ) || menuBtnEl;\n\n    if (el) {\n      el.focus();\n      if (el === menuBtnEl) {\n        // TODO:?\n        // markFocusedMenuButton({ focusedMenuBtn, timeouts, el });\n      }\n    }\n    globalState.closedByEvents = true;\n    setOpen(false);\n  }\n\n  close();\n};\n\nexport const onScrollClose = (e: Event) => {\n  const target = e.target as HTMLElement;\n\n  if (cachedScrollTarget === target) return;\n\n  checkThenClose(\n    dismissStack,\n    (item) => {\n      const { menuPopupEl } = item;\n\n      if (menuPopupEl!.contains(target)) {\n        cachedScrollTarget = target;\n        return { continue: false };\n      }\n\n      return { item, continue: true };\n    },\n    (item) => {\n      const { setOpen, focusElementOnClose, menuBtnEls } = item;\n      const menuBtnEl = getMenuButton(menuBtnEls);\n\n      globalState.closedByEvents = true;\n      setOpen(false);\n\n      const el =\n        queryElement(\n          {},\n          {\n            inputElement: focusElementOnClose,\n            type: \"focusElementOnClose\",\n            subType: \"scrolling\",\n          }\n        ) || menuBtnEl;\n\n      if (el) {\n        el.focus();\n      }\n    }\n  );\n};\n\nexport const addGlobalEvents = (closeWhenScrolling: boolean) => {\n  cachedScrollTarget = null;\n\n  if (!scrollEventAdded && closeWhenScrolling) {\n    scrollEventAdded = false;\n\n    window.addEventListener(\"wheel\", onScrollClose, {\n      capture: true,\n      passive: true,\n    });\n    document.body.addEventListener(\"touchmove\", onTouchMove);\n  }\n\n  if (dismissStack.length) return;\n\n  document.addEventListener(\"pointerdown\", onDocumentPointerDown);\n  document.addEventListener(\"pointerup\", onDocumentPointerUp);\n  document.addEventListener(\"keydown\", onKeyDown);\n  window.addEventListener(\"blur\", onWindowBlur);\n};\n\nexport const removeGlobalEvents = () => {\n  if (dismissStack.length) return;\n\n  scrollEventAdded = false;\n  globalState.cursorKeysPrevEl = null;\n  globalState.clickTarget = null;\n  // globalState.menuBtnEl = null;\n  window.clearTimeout(globalState.documentClickTimeout!);\n  globalState.documentClickTimeout = null;\n  document.removeEventListener(\"keydown\", onKeyDown);\n  document.removeEventListener(\"pointerdown\", onDocumentPointerDown);\n  document.removeEventListener(\"keydown\", onKeyDownFocusIn);\n  window.removeEventListener(\"blur\", onWindowBlur);\n  window.removeEventListener(\"wheel\", onScrollClose, {\n    capture: true,\n  });\n  document.body.removeEventListener(\"touchmove\", onTouchMove);\n};\n\nconst onTouchMove = () => {\n  if (scrollEventAddedViaTouch) return;\n  scrollEventAddedViaTouch = true;\n\n  document.body.addEventListener(\n    \"touchend\",\n    () => {\n      scrollEventAddedViaTouch = false;\n    },\n    { once: true }\n  );\n\n  window.addEventListener(\"scroll\", onScrollClose, {\n    capture: true,\n    passive: true,\n    once: true,\n  });\n};\n\nconst onCursorKeys = (e: KeyboardEvent) => {\n  const keys = [\"ArrowDown\", \"ArrowUp\", \"ArrowLeft\", \"ArrowRight\"];\n  const horizontalKeys = [\"ArrowLeft\", \"ArrowRight\"];\n\n  if (!keys.includes(e.key)) return;\n\n  e.preventDefault();\n\n  if (horizontalKeys.includes(e.key)) return;\n\n  const {\n    menuBtnEls,\n    menuPopupEl,\n    containerEl,\n    focusSentinelBeforeEl,\n    focusSentinelAfterEl,\n    cursorKeys,\n  } = dismissStack[dismissStack.length - 1];\n  const menuBtnEl = getMenuButton(menuBtnEls);\n\n  let activeElement = globalState.cursorKeysPrevEl || document.activeElement!;\n\n  let direction: \"forwards\" | \"backwards\";\n\n  if (e.key === \"ArrowDown\") {\n    direction = \"forwards\";\n  } else {\n    direction = \"backwards\";\n  }\n\n  if (\n    activeElement === menuBtnEl ||\n    activeElement === menuPopupEl ||\n    activeElement === containerEl\n  ) {\n    if (e.key === \"ArrowUp\") {\n      direction = \"backwards\";\n      activeElement = focusSentinelAfterEl!;\n    } else {\n      direction = \"forwards\";\n      activeElement = focusSentinelBeforeEl!;\n    }\n  }\n\n  const isCursorKeysArgObj = typeof cursorKeys === \"object\";\n\n  const willWrap = isCursorKeysArgObj && cursorKeys.wrap;\n  let el = getNextTabbableElement({\n    from: activeElement,\n    direction,\n    stopAtRootElement: menuPopupEl!,\n  });\n\n  if (!el && willWrap) {\n    const from =\n      e.key === \"ArrowDown\" ? focusSentinelBeforeEl! : focusSentinelAfterEl!;\n    direction = e.key === \"ArrowDown\" ? \"forwards\" : \"backwards\";\n\n    el = getNextTabbableElement({\n      from,\n      direction,\n      stopAtRootElement: containerEl!,\n    });\n  }\n\n  if (isCursorKeysArgObj && cursorKeys.onKeyDown) {\n    cursorKeys.onKeyDown({\n      currentEl: el,\n      prevEl: globalState.cursorKeysPrevEl,\n    });\n\n    globalState.cursorKeysPrevEl = el;\n    return;\n  }\n\n  if (el) {\n    el.focus();\n  }\n};\n\nconst onVisibilityChange = () => {\n  if (document.visibilityState === \"visible\" && pollTimeoutId != null) {\n    pollingIframe();\n    return;\n  }\n\n  clearTimeout(pollTimeoutId!);\n};\n\n// polls iframe to deal with edge case if menuPopup item selected is an iframe and then select another iframe that is \"outside\" of menuPopup\nconst pollingIframe = () => {\n  // worst case scenerio is user has to wait for up to 250ms for menuPopup to close, while average case is 125ms\n  const duration = 250;\n\n  const poll = () => {\n    const activeElement = document.activeElement as HTMLElement;\n\n    if (!activeElement) {\n      return;\n    }\n\n    if (cachedPolledElement === activeElement) {\n      pollTimeoutId = window.setTimeout(poll, duration);\n      return;\n    }\n\n    checkThenClose(\n      dismissStack,\n      (item) => {\n        const { containerEl } = item;\n\n        if (activeElement.tagName === \"IFRAME\") {\n          if (containerEl && !containerEl.contains(activeElement)) {\n            return { item, continue: true };\n          }\n          cachedPolledElement = activeElement;\n          pollTimeoutId = window.setTimeout(poll, duration);\n          return { continue: false };\n        }\n\n        if (containerEl && !containerEl.contains(activeElement)) {\n          return { item, continue: true };\n        }\n\n        return { continue: false };\n      },\n      (item) => {\n        const { setOpen } = item;\n        globalState.closedByEvents = true;\n        setOpen(false);\n\n        cachedPolledElement = null;\n        pollTimeoutId = null;\n        document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n      }\n    );\n  };\n\n  pollTimeoutId = window.setTimeout(poll, duration);\n};\n","import { queryElement } from \"../utils/queryElement\";\nimport { TLocalState } from \"./localState\";\n\nexport const addMenuPopupEl = (state: TLocalState) => {\n  const { menuPopup } = state;\n  if (state.menuPopupAdded) return;\n\n  state.menuPopupEl = queryElement(state, {\n    inputElement: menuPopup,\n    type: \"menuPopup\",\n  });\n\n  if (state.menuPopupEl) {\n    state.menuPopupAdded = true;\n\n    state.menuPopupEl.setAttribute(\"tabindex\", \"-1\");\n  }\n};\n\nexport const removeMenuPopupEl = (state: TLocalState) => {\n  if (!state.menuPopupEl) return;\n  if (!state.menuPopupAdded) return;\n  state.menuPopupEl = null;\n  state.menuPopupAdded = false;\n};\n","export const camelize = (s: string) =>\n  s.replace(/-./g, (x) => x.toUpperCase()[1]);\n","import { dismissStack } from \"../global/dismissStack\";\nimport { TLocalState } from \"../local/localState\";\n\nexport const runToggleScrollbar = (state: TLocalState, open: boolean) => {\n  const { onToggleScrollbar, removeScrollbar } = state;\n  if (onToggleScrollbar) {\n    if (open) {\n      if (dismissStack.length > 1) return;\n      onToggleScrollbar.onRemove();\n    } else {\n      if (dismissStack.length) return;\n      onToggleScrollbar.onRestore();\n    }\n    return;\n  }\n\n  if (!removeScrollbar) return;\n\n  if (dismissStack.length > 1) return;\n\n  const el = document.scrollingElement as HTMLElement;\n\n  if (open) {\n    el.style.overflow = \"hidden\";\n  } else {\n    el.style.overflow = \"\";\n  }\n};\n","import {\n  untrack,\n  Component,\n  JSX,\n  createComputed,\n  createSignal,\n  children,\n  batch,\n} from \"solid-js\";\nimport { TLocalState } from \"../local/localState\";\nimport { camelize } from \"../utils/camelize\";\nimport { queryElement } from \"../utils/queryElement\";\nimport { runToggleScrollbar } from \"../utils/runToggleScrollbar\";\n\nexport type DismissAnimation = {\n  /**\n   * Used to automatically generate transition CSS class names. e.g. name: 'fade' will auto expand to .fade-enter, .fade-enter-active, etc.\n   */\n  name?: string;\n  enterActiveClass?: string;\n  enterClass?: string;\n  enterToClass?: string;\n  exitActiveClass?: string;\n  exitClass?: string;\n  exitToClass?: string;\n  onBeforeEnter?: (el: Element) => void;\n  onEnter?: (el: Element, done: () => void) => void;\n  onAfterEnter?: (el: Element) => void;\n  onBeforeExit?: (el: Element) => void;\n  onExit?: (el: Element, done: () => void) => void;\n  onAfterExit?: (el: Element) => void;\n  /**\n   * Change element where CSS classes are appended and passed to callbacks.\n   *\n   * Pass CSS selector, queried from root component, `\"menuPopup\"` uses menuPopup element, or pass JSX element.\n   *\n   * @defaultValue The element is the root element of the component, where CSS classes are appended to, and it is also passed to callbacks.\n   */\n  appendToElement?: \"menuPopup\" | JSX.Element;\n  /**\n   * Whether to apply transition on initial render.\n   *\n   * @defaultValue `false`\n   */\n  appear?: boolean;\n};\n\nfunction nextFrame(fn: () => void) {\n  requestAnimationFrame(() => {\n    requestAnimationFrame(fn);\n  });\n}\n\nexport const Transition: Component<\n  DismissAnimation & {\n    children: JSX.Element;\n    mode?: \"inout\" | \"outin\";\n    overlay?: DismissAnimation;\n    state: TLocalState;\n  }\n> = (props) => {\n  let el: Element;\n  let first = true;\n  let isPortal = false;\n  let portalMarker!: Text;\n  let isExiting = false;\n  let hasOverlayAnimation = !!props.overlay;\n  const [s1, set1] = createSignal<Element | undefined>();\n  const [s2, set2] = createSignal<Element | undefined>();\n  const resolved = children(() => props.children);\n\n  const {\n    onBeforeEnter,\n    onEnter,\n    onAfterEnter,\n    onBeforeExit,\n    onExit,\n    onAfterExit,\n    appendToElement,\n    appear,\n    state,\n  } = props;\n  const {\n    onBeforeEnter: onBeforeEnterOverlay,\n    onEnter: onEnterOverlay,\n    onAfterEnter: onAfterEnterOverlay,\n    onBeforeExit: onBeforeExitOverlay,\n    onExit: onExitOverlay,\n    onAfterExit: onAfterExitOverlay,\n    appendToElement: appendToElementOverlay,\n  } = props.overlay || {};\n\n  type TAnimatedEl = \"overlay\" | \"content\";\n  const createOnBeforeEnter = (type: TAnimatedEl) =>\n    type === \"content\" ? onBeforeEnter : onBeforeEnterOverlay;\n  const createOnEnter = (type: TAnimatedEl) =>\n    type === \"content\" ? onEnter : onEnterOverlay;\n  const createOnAfterEnter = (type: TAnimatedEl) =>\n    type === \"content\" ? onAfterEnter : onAfterEnterOverlay;\n  const createOnBeforeExit = (type: TAnimatedEl) =>\n    type === \"content\" ? onBeforeExit : onBeforeExitOverlay;\n  const createOnExit = (type: TAnimatedEl) =>\n    type === \"content\" ? onExit : onExitOverlay;\n  const createOnAfterExit = (type: TAnimatedEl) =>\n    type === \"content\" ? onAfterExit : onAfterExitOverlay;\n\n  function getClassState(\n    animatedElType: TAnimatedEl,\n    type:\n      | \"enter\"\n      | \"enter-active\"\n      | \"enter-to\"\n      | \"exit\"\n      | \"exit-active\"\n      | \"exit-to\"\n  ) {\n    const getName = () => {\n      return animatedElType === \"content\" ? props.name : props.overlay?.name;\n    };\n    const name = getName() || \"s\";\n    const propStr = camelize(type) + \"Class\";\n    const classAnimationStates =\n      animatedElType === \"content\" ? props : props.overlay;\n    // @ts-ignore\n    const classState = classAnimationStates[propStr] as string;\n    return classState ? classState.split(\" \") : [`${name}-${type}`];\n  }\n\n  const getElement = (type: TAnimatedEl, el: Element) => {\n    const appendToElement_ =\n      type === \"content\" ? appendToElement : appendToElementOverlay;\n\n    if (appendToElement_) {\n      if (appendToElement_ === \"menuPopup\" && type !== \"overlay\") {\n        return queryElement(\n          { containerEl: el as HTMLDivElement },\n          { inputElement: null, type: \"menuPopup\" }\n        );\n      }\n\n      return typeof appendToElement_ === \"string\"\n        ? el && el.querySelector(appendToElement_)!\n        : (appendToElement_ as Element);\n    }\n    return el;\n  };\n\n  let endExitTransitionRef: any;\n  let endExitTransitionOverlayRef: any;\n\n  function enterTransition(\n    type: TAnimatedEl,\n    _el: Element,\n    prev: Element | undefined\n  ) {\n    // TODO: refactor this\n    if (isExiting) {\n      if (type === \"content\") {\n        endExitTransitionRef();\n      } else {\n        endExitTransitionOverlayRef();\n      }\n    }\n    if (!first || props.appear) {\n      const onEnter = createOnEnter(type);\n      const onBeforeEnter = createOnBeforeEnter(type);\n      const onAfterEnter = createOnAfterEnter(type);\n\n      const enterClasses = getClassState(type, \"enter\");\n      const enterActiveClasses = getClassState(type, \"enter-active\");\n      const enterToClasses = getClassState(type, \"enter-to\");\n      const el = getElement(type, _el);\n\n      onBeforeEnter && onBeforeEnter(el);\n      el.classList.add(...enterClasses);\n      el.classList.add(...enterActiveClasses);\n\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          el.classList.remove(...enterClasses);\n          el.classList.add(...enterToClasses);\n        });\n        onEnter && onEnter(el, () => endTransition());\n        requestAnimationFrame(() => {\n          if (!onEnter || onEnter.length < 2) {\n            el.addEventListener(\"transitionend\", endTransition);\n            el.addEventListener(\"animationend\", endTransition);\n          }\n        });\n      });\n\n      function endTransition(e?: Event) {\n        if (el && (!e || e.target === el)) {\n          el.removeEventListener(\"transitionend\", endTransition);\n          el.removeEventListener(\"animationend\", endTransition);\n          el.classList.remove(...enterActiveClasses);\n          el.classList.remove(...enterToClasses);\n          batch(() => {\n            const el_ = isPortal ? (portalMarker as unknown as Element) : _el;\n            s1() !== el_ && set1(el_);\n            s2() === el_ && set2(undefined);\n          });\n          onAfterEnter && onAfterEnter(el);\n          if (props.mode === \"inout\") exitTransition(type, el, prev!);\n        }\n      }\n    }\n    if (type === \"content\") {\n      const el_ = isPortal ? (portalMarker as unknown as Element) : _el;\n      prev && !props.mode ? set2(el_) : set1(el_);\n    }\n  }\n\n  function exitTransition(type: TAnimatedEl, _el: Element, _prev: Element) {\n    isExiting = true;\n    const onExit = createOnExit(type);\n    const onBeforeExit = createOnBeforeExit(type);\n    const onAfterExit = createOnAfterExit(type);\n\n    const exitClasses = getClassState(type, \"exit\");\n    const exitActiveClasses = getClassState(type, \"exit-active\");\n    const exitToClasses = getClassState(type, \"exit-to\");\n    const el = getElement(type, _el);\n    const prev = getElement(type, _prev);\n\n    if (!prev.parentNode) return endTransition();\n    onBeforeExit && onBeforeExit(prev);\n    prev.classList.add(...exitClasses);\n    prev.classList.add(...exitActiveClasses);\n    nextFrame(() => {\n      prev.classList.remove(...exitClasses);\n      prev.classList.add(...exitToClasses);\n    });\n    onExit && onExit(prev, () => endTransition());\n    if (!onExit || onExit.length < 2) {\n      prev.addEventListener(\"transitionend\", endTransition);\n      prev.addEventListener(\"animationend\", endTransition);\n    }\n\n    function endTransition(e?: Event) {\n      if (!e || e.target === prev) {\n        isExiting = false;\n        prev.removeEventListener(\"transitionend\", endTransition);\n        prev.removeEventListener(\"animationend\", endTransition);\n        if (type === \"content\") {\n          prev.classList.remove(...exitActiveClasses);\n          prev.classList.remove(...exitToClasses);\n        }\n\n        if (type === \"content\") {\n          if (isPortal) {\n            // @ts-ignore\n            _prev.parentElement.remove();\n            runToggleScrollbar(state, false);\n          }\n\n          s1() === _prev && set1(undefined);\n        }\n        onAfterExit && onAfterExit(prev);\n        if (props.mode === \"outin\") enterTransition(type, el, prev);\n      }\n    }\n\n    if (type === \"content\") {\n      endExitTransitionRef = endTransition;\n    } else {\n      endExitTransitionOverlayRef = endTransition;\n    }\n  }\n\n  createComputed<Element>((prev) => {\n    el = resolved() as Element;\n    while (typeof el === \"function\") el = (el as Function)();\n\n    if (el && el.nodeType === 3) {\n      isPortal = true;\n      portalMarker = el as unknown as Text;\n      // @ts-ignore\n      portalMarker.willRemove = false;\n      // @ts-ignore\n      const portalContainerChild = el[\"portalContainerChild\"];\n      if (hasOverlayAnimation) {\n        // @ts-ignore\n        const overlayChildren = el[\"portalOverlay\"];\n        Object.defineProperty(portalContainerChild, \"portalOverlay\", {\n          get() {\n            return overlayChildren;\n          },\n          configurable: true,\n        });\n      }\n      el = portalContainerChild;\n    }\n\n    return untrack(() => {\n      if (el && el !== prev) {\n        if (props.mode !== \"outin\") {\n          enterTransition(\"content\", el, prev);\n          if (hasOverlayAnimation) {\n            enterTransition(\n              \"overlay\",\n              // @ts-ignore\n              el.portalOverlay,\n              // @ts-ignore\n              prev && prev.portalOverlay\n            );\n          }\n        } else if (first) {\n          const _el = isPortal ? (portalMarker as unknown as Element) : el;\n          set1(_el);\n        }\n      }\n\n      if (prev && prev !== el && props.mode !== \"inout\") {\n        exitTransition(\"content\", el, prev);\n        if (hasOverlayAnimation) {\n          // @ts-ignore\n          exitTransition(\"overlay\", el && el.portalOverlay, prev.portalOverlay);\n        }\n      }\n      first = false;\n      return el;\n    });\n  });\n\n  return [s1, s2] as unknown as JSX.Element;\n};\n","import { TLocalState } from \"./localState\";\nimport { removeMenuButtonEvents } from \"./menuButton\";\n\nexport const removeLocalEvents = (\n  state: TLocalState,\n  { isCleanup = false }: { isCleanup?: boolean } = {}\n) => {\n  removeMenuButtonEvents(state, isCleanup);\n};\n","import { dismissStack } from \"../global/dismissStack\";\nimport {\n  globalState,\n  onKeyDownFocusIn,\n  runLastAfterEvents,\n} from \"../global/globalEvents\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\nimport { isObjectLiteral } from \"../utils/isObjectLiteral\";\nimport { queryElement } from \"../utils/queryElement\";\nimport { TLocalState } from \"./localState\";\nimport {\n  addEventsToActiveMountedPopup,\n  getActiveMountedPopupFromSafeList,\n  removeEventsOnActiveMountedPopup,\n} from \"./thirdPartyPopup\";\n\nexport const onFocusOutContainer = (state: TLocalState, e: FocusEvent) => {\n  const {\n    overlayElement,\n    trapFocus,\n    timeouts,\n    closeWhenDocumentBlurs,\n    mountedPopupsSafeList,\n  } = state;\n\n  timeoutFocusOutFired = false;\n\n  queueMicrotask(() => {\n    runLastAfterEvents();\n  });\n\n  if (globalState.thirdPartyPopupEl) {\n    removeEventsOnActiveMountedPopup();\n  }\n  if (globalState.closedBySetOpen) return;\n  if (globalState.overlayMouseDown) return;\n  if (overlayElement && trapFocus) return;\n  if (!closeWhenDocumentBlurs && !document.hasFocus()) return;\n\n  const dismissStackLength = dismissStack.length;\n\n  setTimeoutFocusOut(timeouts, () => {\n    if (mountedPopupsSafeList) {\n      if (getActiveMountedPopupFromSafeList(mountedPopupsSafeList)) {\n        addEventsToActiveMountedPopup();\n        return;\n      }\n    }\n\n    // fixes issue where race condition of new item mounts before timeout focusout fires\n    // therefore focused item which is menuButton, the new container doesn't contain, so removes stack\n    if (dismissStackLength < dismissStack.length) return;\n\n    globalState.closedByEvents = true;\n\n    checkThenClose(\n      dismissStack,\n      (item) => {\n        const { containerEl, closeWhenClickingOutside } = item;\n\n        const clickTarget = globalState.clickTarget;\n        if (!closeWhenClickingOutside && clickTarget) {\n          document.addEventListener(\"keydown\", onKeyDownFocusIn);\n          return { continue: false };\n        }\n        if (clickTarget && containerEl.contains(clickTarget)) {\n          return { continue: false };\n        }\n\n        if (containerEl.contains(document.activeElement)) {\n          return { continue: false };\n        }\n\n        return { item, continue: true };\n      },\n      (item) => {\n        const { setOpen } = item;\n        setOpen(false);\n      }\n    );\n  });\n};\n\nexport const onFocusInContainer = (state: TLocalState, e: FocusEvent) => {\n  const { timeouts } = state;\n\n  clearTimeout(timeouts.containerFocusTimeoutId!);\n  clearTimeout(timeouts.menuButtonBlurTimeoutId!);\n};\n\nexport const runFocusOnActive = (state: TLocalState) => {\n  const { focusElementOnOpen, focusedMenuBtn } = state;\n  if (focusElementOnOpen == null) {\n    return;\n  }\n\n  const el = queryElement(state, {\n    inputElement: focusElementOnOpen,\n    type: \"focusElementOnOpen\",\n  });\n\n  if (el) {\n    setTimeout(() => {\n      const preventScroll = isObjectLiteral(focusElementOnOpen)\n        ? // @ts-ignore\n          !!focusElementOnOpen.preventScroll\n        : el === state.menuPopupEl;\n      el.focus({ preventScroll });\n      focusedMenuBtn.el = null;\n    });\n  }\n};\n\nlet timeoutFocusOutFired = false;\nconst setTimeoutFocusOut = (\n  timeouts: TLocalState[\"timeouts\"],\n  cb: () => void\n) => {\n  timeouts.containerFocusTimeoutId = window.setTimeout(() => {\n    if (timeoutFocusOutFired) return;\n    timeoutFocusOutFired = true;\n    cb();\n  });\n};\n","import { dismissStack } from \"../global/dismissStack\";\nimport { globalState } from \"../global/globalEvents\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\nimport { queryElement } from \"../utils/queryElement\";\nimport { TLocalState } from \"./localState\";\nimport { getMenuButton } from \"./menuButton\";\n\nexport const onMouseDownOverlay = () => {\n  globalState.overlayMouseDown = true;\n};\nexport const onMouseUpOverlay = () => {\n  globalState.overlayMouseDown = false;\n};\n\nexport const onClickOverlay = (state: TLocalState) => {\n  const {\n    closeWhenOverlayClicked,\n    menuPopupEl,\n    focusElementOnClose,\n    menuBtnEls,\n  } = state;\n  globalState.overlayMouseDown = false;\n\n  if (!closeWhenOverlayClicked) {\n    menuPopupEl!.focus({ preventScroll: true });\n\n    return;\n  }\n\n  const menuBtnEl = getMenuButton(menuBtnEls!);\n\n  const el =\n    queryElement(state, {\n      inputElement: focusElementOnClose,\n      type: \"focusElementOnClose\",\n      subType: \"click\",\n    }) || menuBtnEl;\n\n  if (el) {\n    el.focus();\n  }\n\n  checkThenClose(\n    dismissStack,\n    (item) => {\n      if (item.overlayElement) return { continue: false };\n      return { item, continue: true };\n    },\n    (item) => {\n      const { setOpen } = item;\n      globalState.closedByEvents = true;\n      setOpen(false);\n    }\n  );\n\n  globalState.closedByEvents = true;\n  state.setOpen(false);\n};\n","export const matchByFirstChild = ({\n  parent,\n  matchEl,\n}: {\n  parent: HTMLElement | Element;\n  matchEl: HTMLElement;\n}) => {\n  if (parent === matchEl) return true;\n\n  const query = (el: Element): boolean => {\n    if (!el) return false;\n    const child = el.children[0];\n\n    if (child === matchEl) {\n      return true;\n    }\n\n    return query(child);\n  };\n\n  return query(parent);\n};\n","import { dismissStack } from \"../global/dismissStack\";\nimport { globalState } from \"../global/globalEvents\";\nimport { checkThenClose } from \"../utils/checkThenClose\";\nimport { matchByFirstChild } from \"../utils/matchByFirstChild\";\nimport { queryElement } from \"../utils/queryElement\";\nimport { getNextTabbableElement } from \"../utils/tabbing\";\nimport { TLocalState } from \"./localState\";\nimport { getMenuButton } from \"./menuButton\";\n\nexport const activateLastFocusSentinel = (state: TLocalState) => {\n  const {\n    enableLastFocusSentinel,\n    menuBtnEls,\n    containerEl,\n    focusSentinelAfterEl,\n  } = state;\n  // Before\n  // if (enableLastFocusSentinel) return;\n  if (enableLastFocusSentinel) {\n    focusSentinelAfterEl!.setAttribute(\"tabindex\", \"0\");\n    return;\n  }\n\n  if (!menuBtnEls) return;\n\n  const menuBtnEl = getMenuButton(menuBtnEls!);\n\n  const menuBtnSibling = menuBtnEl!.nextElementSibling!;\n\n  if (\n    matchByFirstChild({\n      parent: menuBtnSibling,\n      matchEl: containerEl!,\n    })\n  )\n    return;\n\n  focusSentinelAfterEl!.setAttribute(\"tabindex\", \"0\");\n};\n\nexport const onFocusSentinel = (\n  state: TLocalState,\n  type: \"before\" | \"after\" | \"last\",\n  relatedTarget?: HTMLElement\n) => {\n  const {\n    uniqueId,\n    containerEl,\n    menuBtnEls,\n    focusSentinelBeforeEl,\n    trapFocus,\n    focusSentinelAfterEl,\n    closeWhenMenuButtonIsTabbed,\n    focusElementOnClose,\n    mount,\n    open,\n    setOpen,\n  } = state;\n  const menuBtnEl = getMenuButton(menuBtnEls!);\n\n  dismissStack.forEach((item) =>\n    window.clearTimeout(item.timeouts.containerFocusTimeoutId!)\n  );\n\n  const runIfMounted = (el: HTMLElement, isFirst?: boolean) => {\n    checkThenClose(\n      dismissStack,\n      (item) => {\n        if (isFirst) {\n          if (\n            getMenuButton(item.menuBtnEls) === el &&\n            !item.closeWhenMenuButtonIsTabbed\n          ) {\n            return { continue: false };\n          }\n        }\n        if (item.uniqueId === uniqueId || !item.containerEl.contains(el)) {\n          return { item, continue: true };\n        }\n\n        return { continue: false };\n      },\n      (item) => {\n        globalState.closedByEvents = true;\n        item.setOpen(false);\n      }\n    );\n\n    if (el) {\n      el.focus();\n    }\n  };\n\n  if (!open()) return;\n\n  if (\n    menuBtnEl &&\n    (relatedTarget === containerEl || relatedTarget === menuBtnEl)\n  ) {\n    const el = getNextTabbableElement({\n      from: focusSentinelBeforeEl!,\n      direction: \"forwards\",\n      stopAtRootElement: containerEl,\n    })!;\n\n    el.focus();\n    return;\n  }\n\n  if (type === \"before\") {\n    if (trapFocus) {\n      const el = getNextTabbableElement({\n        from: focusSentinelAfterEl!,\n        direction: \"backwards\",\n        stopAtRootElement: containerEl,\n      })!;\n\n      el.focus();\n      return;\n    }\n\n    if (closeWhenMenuButtonIsTabbed) {\n      globalState.closedByEvents = true;\n      setOpen(false);\n      menuBtnEl!.focus();\n      return;\n    }\n\n    const el =\n      queryElement(state, {\n        inputElement: focusElementOnClose,\n        type: \"focusElementOnClose\",\n        subType: \"tabBackwards\",\n      }) || menuBtnEl;\n\n    // conditional and early return just for no button feature\n    if (!state.menuBtnEls) {\n      // this wasn't here before\n      el.focus();\n      return;\n    }\n    // this wasn't wrapped with mount condition when it should be\n    // if (mount) {\n    runIfMounted(el, true);\n    // }\n    // so\n    return;\n  }\n\n  if (trapFocus) {\n    const el = getNextTabbableElement({\n      from: focusSentinelBeforeEl!,\n      stopAtRootElement: containerEl,\n    })!;\n\n    el.focus();\n    return;\n  }\n\n  const el =\n    queryElement(state, {\n      inputElement: focusElementOnClose,\n      type: \"focusElementOnClose\",\n      subType: \"tabForwards\",\n    }) ||\n    getNextTabbableElement({\n      from: menuBtnEl!,\n      ignoreElement: [containerEl!],\n    });\n  if (mount) {\n    runIfMounted(el);\n    return;\n  }\n\n  if (el) {\n    el.focus();\n  }\n\n  globalState.closedByEvents = true;\n  setOpen(false);\n};\n","import {\n  createRoot,\n  createSignal,\n  onCleanup,\n  sharedConfig,\n  JSX,\n} from \"solid-js\";\nimport { insert } from \"solid-js/web\";\n\nconst SVG_NAMESPACE = \"http://www.w3.org/2000/svg\";\n\nfunction createElement(\n  tagName: string,\n  isSVG = false\n): HTMLElement | SVGElement {\n  return isSVG\n    ? document.createElementNS(SVG_NAMESPACE, tagName)\n    : document.createElement(tagName);\n}\n\nfunction CustomPortal<\n  T extends boolean = false,\n  S extends boolean = false\n>(props: {\n  mount?: Node;\n  useShadow?: T;\n  isSVG?: S;\n  ref?:\n    | (S extends true ? SVGGElement : HTMLDivElement)\n    | ((\n        el: (T extends true ? { readonly shadowRoot: ShadowRoot } : {}) &\n          (S extends true ? SVGGElement : HTMLDivElement)\n      ) => void);\n\n  overlayChildren?: JSX.Element;\n  isModal?: boolean;\n  children: JSX.Element;\n}) {\n  const { useShadow, isModal } = props,\n    marker = document.createTextNode(\"\"),\n    mount = props.mount || document.body;\n\n  // don't render when hydrating\n  function renderPortal() {\n    if (sharedConfig.context) {\n      const [s, set] = createSignal(false);\n      queueMicrotask(() => set(true));\n      return () => s() && props.children;\n    } else return () => props.children;\n  }\n\n  if (mount instanceof HTMLHeadElement) {\n    const [clean, setClean] = createSignal(false);\n    const cleanup = () => setClean(true);\n    createRoot((dispose) =>\n      insert(mount, () => (!clean() ? renderPortal()() : dispose()), null)\n    );\n    onCleanup(() => {\n      if (sharedConfig.context) queueMicrotask(cleanup);\n      else cleanup();\n    });\n  } else {\n    const container = createElement(props.isSVG ? \"g\" : \"div\", props.isSVG),\n      renderRoot =\n        useShadow && container.attachShadow\n          ? container.attachShadow({ mode: \"open\" })\n          : container;\n\n    const containerObjectValue = {\n      get() {\n        return marker.parentNode;\n      },\n      configurable: true,\n    };\n    Object.defineProperty(container, \"host\", containerObjectValue);\n    Object.defineProperty(container, \"_$host\", containerObjectValue);\n    // will be \"_$portalContainerChild\"\n    Object.defineProperty(marker, \"portalContainerChild\", {\n      get() {\n        if (overlayChildren) {\n          return container.children[1];\n        }\n        // return container.querySelector('[role=\"dialog\"]');\n        return container.firstElementChild;\n      },\n      configurable: true,\n    });\n    Object.defineProperty(marker, \"portalContainer\", {\n      get() {\n        return container;\n      },\n      configurable: true,\n    });\n    Object.defineProperty(marker, \"portalMount\", {\n      get() {\n        return mount;\n      },\n      configurable: true,\n    });\n    // @ts-ignore\n    marker.willRemove = true;\n    insert(renderRoot, renderPortal());\n    const overlayChildren = props.overlayChildren;\n    if (overlayChildren) {\n      // Object.defineProperty(containerFirstChild, \"portalOverlay\", {\n      //   get() {\n      //     return overlayChildren;\n      //   },\n      //   configurable: true,\n      // });\n      Object.defineProperty(marker, \"portalOverlay\", {\n        get() {\n          return overlayChildren;\n        },\n        configurable: true,\n      });\n      container.insertAdjacentElement(\n        \"afterbegin\",\n        overlayChildren as HTMLElement\n      );\n    }\n    mount.appendChild(container);\n    (props as any).ref && (props as any).ref(container);\n    onCleanup(() => {\n      // @ts-ignore\n      if (!marker.willRemove) return;\n      mount.removeChild(container);\n    });\n  }\n  return marker;\n}\n\nexport default CustomPortal;\n","import { isServer } from \"solid-js/web\";\nimport {\n  untrack,\n  Accessor,\n  createEffect,\n  onCleanup,\n  JSX,\n  on,\n  createUniqueId,\n  createMemo,\n  ParentComponent,\n  createComputed,\n} from \"solid-js\";\nimport {\n  dismissStack,\n  addDismissStack,\n  removeDismissStack,\n  TDismissStack,\n} from \"./global/dismissStack\";\nimport {\n  addGlobalEvents,\n  globalState,\n  onDocumentPointerDown,\n  removeGlobalEvents,\n} from \"./global/globalEvents\";\nimport { TLocalState } from \"./local/localState\";\nimport { addMenuPopupEl, removeMenuPopupEl } from \"./local/menuPopup\";\nimport {\n  addMenuButtonEventsAndAttributes,\n  getMenuButton,\n  markFocusedMenuButton,\n  onBlurMenuButton,\n  onClickMenuButton,\n  onClickOutsideMenuButton,\n  onFocusMenuButton,\n  onKeydownMenuButton,\n  onMouseDownMenuButton,\n  removeMenuButtonEvents,\n  setTargetAriaExpandFalse,\n  setTargetAriaExpandTrue,\n} from \"./local/menuButton\";\nimport { DismissAnimation, Transition } from \"./components/Transition\";\nimport { removeLocalEvents } from \"./local/manageLocalEvents\";\nimport {\n  onFocusInContainer,\n  onFocusOutContainer,\n  runFocusOnActive,\n} from \"./local/container\";\nimport {\n  onClickOverlay,\n  onMouseDownOverlay,\n  onMouseUpOverlay,\n} from \"./local/overlay\";\nimport {\n  activateLastFocusSentinel,\n  onFocusSentinel,\n} from \"./local/focusSentinel\";\nimport { queryElement } from \"./utils/queryElement\";\nimport { getNextTabbableElement } from \"./utils/tabbing\";\nimport CustomPortal from \"./components/CustomPortal\";\nimport { removeEventsOnActiveMountedPopup } from \"./local/thirdPartyPopup\";\nimport { runToggleScrollbar } from \"./utils/runToggleScrollbar\";\n\n/**\n * ### Notes\n *\n * In documentation, for menuButton ref, use `createSignal` from now on. Users get to place Dismiss JSX anywhere (including before button element), and pass accessor to their custom Dismiss hooks without any issues.\n *\n * When using modals, inform users they must use `roll=\"dialog\"`\n *\n */\n\nexport type TDismiss = {\n  /**\n   * sets id attribute for root component\n   */\n  id?: string;\n  ref?: JSX.Element;\n  class?: string;\n  classList?: { [key: string]: boolean };\n  open: Accessor<boolean>;\n  setOpen: (v: boolean) => void;\n  /**\n   * callback when setOpen signal changes\n   */\n  onOpen?: OnOpenHandler;\n  /**\n   * CSS selector, queried from document, to get menu button element. Or pass JSX element\n   *\n   * @remark There are situations where there are multiple JSX menu buttons that open the same menu popup, but only one of them is rendered based on device width. Use signal if JSX menu buttons are conditionally rendered. Use array if all menu buttons are rendered, when all but one, are hidden via CSS `display: none;` declaration.\n   */\n  menuButton:\n    | string\n    | JSX.Element\n    | Accessor<JSX.Element>\n    | (string | JSX.Element)[];\n  /**\n   *\n   * CSS selector, queried from document, to get menu popup element. Or pass JSX element\n   *\n   * @defaultValue root component element queries first child element\n   */\n  menuPopup?: string | JSX.Element | (() => JSX.Element);\n  /**\n   *\n   * Have the behavior to move through a list of \"dropdown items\" using cursor keys.\n   *\n   * @defaultValue `false`\n   */\n  cursorKeys?:\n    | boolean\n    | {\n        /**\n         * When focused on the last dropdown item, when continueing in the same direction, the first item will be focused.\n         *\n         * @defaultValue `false`\n         */\n        wrap: boolean;\n        onKeyDown?: (props: {\n          currentEl: HTMLElement | null;\n          prevEl: HTMLElement | null;\n        }) => void;\n      };\n  /**\n   *\n   * Focus will remain inside menuPopup when pressing Tab key\n   *\n   * @defaultValue `false`\n   */\n  trapFocus?: boolean;\n  /**\n   *\n   * which element, via selector*, to recieve focus after popup opens.\n   *\n   * *CSS string queried from menuPopup element. If string value is `\"menuPopup\"` uses menuPopup element. `\"firstChild\"` uses first tabbable element inside menuPopup. `\"none\"` focus remains on `\"menuButton\"`, even if `Dismiss.modal` is true.\n   *\n   * @defaultValue focus remains on `\"menuButton\"`. But if there's no menu button, focus remains on document's activeElement.\n   */\n  focusElementOnOpen?:\n    | \"menuPopup\"\n    | \"firstChild\"\n    | \"none\"\n    | JSX.Element\n    | (() => JSX.Element)\n    | {\n        target:\n          | \"menuPopup\"\n          | \"firstChild\"\n          | \"none\"\n          | JSX.Element\n          | (() => JSX.Element);\n        preventScroll?: boolean;\n      };\n  /**\n   *\n   * Which element, via selector*, to recieve focus after popup closes.\n   *\n   * *CSS string queried from document, or if string value is `\"menuButton\"` uses menuButton element\n   *\n   * @remarks\n   *\n   * If menuPopup is mounted elsewhere in the DOM or doesn't share the same parent as menuButton, when tabbing outside menuPopup, this library programmatically grabs the correct next tabbable element after menuButton. However if that next tabbable element is inside an iframe that has different origin, then this library won't be able to grab tabbable elements inside it, instead the iframe will be focused.\n   *\n   *\n   * @defaultValue\n   *\n   * When Tabbing forwards, focuses on tabbable element after menuButton. When Tabbing backwards, focuses on menuButton. When pressing Escape key, menuButton will be focused. When programmatically closed, such as clicking close button, then menuButton will be focused. When \"click\" outside, user-agent determines which element recieves focus, however if `Dismiss.overlay` or `Dismiss.overlayElement` are set, then menuButton will be focused instead.\n   */\n  focusElementOnClose?:\n    | \"menuButton\"\n    | JSX.Element\n    | {\n        /**\n         *\n         * focus on element when exiting menuPopup via tabbing backwards ie \"Shift + Tab\".\n         *\n         * @defaultValue `\"menuButton\"`\n         *\n         */\n        tabBackwards?: \"menuButton\" | JSX.Element;\n        /**\n         *\n         * focus on element when exiting menuPopup via tabbing forwards ie \"Tab\".\n         *\n         * @remarks\n         *\n         *  If popup is mounted elsewhere in the DOM, when tabbing outside, this library is able to grab the correct next tabbable element after menuButton, except for tabbable elements inside iframe with cross domain.\n         *\n         * @defaultValue next tabbable element after menuButton;\n         */\n        tabForwards?: \"menuButton\" | JSX.Element;\n        /**\n         * focus on element when exiting menuPopup via click outside popup.\n         *\n         * If mounted overlay present, and popup closes via click, then menuButton will be focused.\n         *\n         * @remarks\n         *\n         * When clicking, user-agent determines which element recieves focus.\n         */\n        click?: \"menuButton\" | JSX.Element;\n        /**\n         *\n         * focus on element when exiting menuPopup via \"Escape\" key\n         *\n         * @defaultValue `\"menuButton\"`\n         */\n        escapeKey?: \"menuButton\" | JSX.Element;\n        /**\n         *\n         * focus on element when exiting menuPopup via scrolling, from scrollable container that contains menuButton\n         *\n         * @dafaultValue `\"menuButton\"`\n         */\n        scrolling?: \"menuButton\" | JSX.Element;\n      };\n  /**\n   * @default `true`\n   *\n   * Set to `false` if you want to switch focus from menuButton to menuPopup input element while keeping virtual keyboard opened in iOS. However end-user must also provide additional logic to fire inside menuButton onclick for behavior to work.\n   */\n  focusMenuButtonOnMouseDown?: boolean;\n  /**\n   * When `true`, clicking or focusing on menuButton doesn't toggle menuPopup. However the menuButton is still used as reference from `focusElementOnClose`\n   *\n   * @defaultValue `false`\n   */\n  deadMenuButton?: boolean;\n  /**\n   *\n   * When `true`, after focusing within menuPopup, if focused back to menu button via keyboard (Tab key), the menuPopup will close.\n   *\n   * @defaultValue `false`\n   */\n  closeWhenMenuButtonIsTabbed?: boolean;\n  /**\n   *\n   * If `overlay` is `true`, menuPopup will always close when menu button is clicked\n   *\n   * @defaultValue `true`\n   */\n  closeWhenMenuButtonIsClicked?: boolean;\n  /**\n   *\n   * Closes menuPopup when any scrollable container (except inside menuPopup) is scrolled\n   *\n   * @remark\n   *\n   * Even when `true`, scrolling in \"outside\" scrollable iframe won't be able to close menuPopup.\n   *\n   * @defaultValue `false`\n   */\n  closeWhenScrolling?: boolean;\n  /**\n   *\n   * If `false`, menuPopup won't close when overlay backdrop is clicked. When overlay clicked, menuPopup will recieve focus.\n   *\n   * @defaultValue `true`\n   */\n\n  closeWhenOverlayClicked?: boolean;\n  /**\n   *\n   * Closes menuPopup when escape key is pressed\n   *\n   * @defaultValue `true`\n   */\n  closeWhenEscapeKeyIsPressed?: boolean;\n  /**\n   *\n   * If `true`, closes menuPopup when the document \"blurs\". This would happen when interacting outside of the page such as Devtools, changing browser tabs, or switch different applications. Also if the page with the menuPopup, is inside an iframe, interacting outside the iframe, will close it.\n   *\n   * @remarks This doesn't effect overlays, if `Dimsiss.overlay` or `Dismiss.overlayElement` are set.\n   *\n   * @defaultValue `false`\n   *\n   */\n  closeWhenDocumentBlurs?: boolean;\n  /**\n   * If `false`, when clicking outside, menuPopup remains open.\n   *\n   * Clicking other menuButtons that aren't part of the menuPopup stack will close those menuPopups.\n   *\n   * Only to be used with non overlay/modal popups, for them use `closeWhenOverlayClicked`.\n   *\n   * @defaultValue `true`\n   */\n  closeWhenClickingOutside?: boolean;\n  /**\n   *\n   * If `true`, sets \"overflow: hidden\" declaration to Document.scrollingElement.\n   *\n   * @defaultValue `false`\n   */\n  removeScrollbar?: boolean;\n  /**\n   *\n   * Customize the removal of the scrollbar to prevent visual page \"jank\".\n   *\n   * @defaultValue `false`\n   */\n  onToggleScrollbar?: {\n    onRemove: () => void;\n    onRestore: () => void;\n  };\n  /**\n   * Prevent page interaction when clicking outside to close menuPopup\n   *\n   * Author must create overlay element within menuPopup, this way page elements underneath the menuPopup can't be interacted with.\n   *\n   *\n   * @defaultValue `false`\n   */\n  overlay?: boolean;\n  /**\n   * Prevent page interaction when clicking outside to close menuPopup\n   *\n   * Adds root level div that acts as a layer. This removes interaction of the page elements that's underneath the overlay element, that way menuPopup is the only element that can be interacted with.\n   *\n   * @defaultValue `false`\n   */\n  overlayElement?:\n    | boolean\n    | {\n        ref?: (el: HTMLElement) => void;\n        class?: string;\n        classList?: { [key: string]: boolean };\n        animation?: DismissAnimation;\n        element?: JSX.Element;\n      };\n  /**\n   * Shorthand for `Dismiss.overlay` to `true`, `Dismiss.overlayElement` to `true`, `Dismiss.trapFocus` to `true`, `Dismiss.removeScrollbar` to `true`, and `Dismiss.mount` to `\"body\"`. Does not override the values of already setted properties.\n   *\n   * Also adds `pointer-events: none;` css declaration to menuPopup element and then `pointer-events: all;` to either element that has role=\"dialog\" attribute or first child of menuPopup element.\n   *\n   * @defaultValue `false`\n   */\n  modal?: boolean;\n  /**\n   *\n   * activates sentinel element as last tabbable item in menuPopup, that way when Tabbing \"forwards\" out of menuPopup, the next logical tabblable element after menuButton will be focused.\n   *\n   *\n   * @defaultValue `false` unless `Dismiss.mount` is set, `Dismiss.focusElementOnClosed` is set, `Dismiss.overlay` prop is `true`, or this component's root container is not an adjacent sibling of menuButton.\n   */\n  enableLastFocusSentinel?: boolean;\n  /**\n   *\n   * Inserts menuPopup in the mount node. Useful for inserting menuPopup outside of page layout. Events still propagate through the Component Hierarchy.\n   */\n  mount?: string | Node;\n  /**\n   * Place CSS class names or JS Web Animation to fire animation as menuPopup enters/exits\n   *\n   * @defaultValue none\n   */\n  animation?: DismissAnimation;\n  /**\n   * Determine whether children are rendered always, or conditionally.\n   *\n   * If `true`, children are rendered.\n   *\n   * @defaultValue `false`, children are conditionally rendered based on `Dismiss.open` value.\n   */\n  show?: boolean;\n  /**\n   * If `true`, when pressing Tab key, all tabbable elements in menuPopup are ignored, and the next focusable element is based on `focusElementOnClose`.\n   *\n   * @defaultValue `false`\n   */\n  // disableTabbingInMenuPopup?: boolean;\n  ignoreMenuPopupWhenTabbing?: boolean;\n  /**\n   * Pass CSS selector strings in array, which then are queried from document, then if those elements are interacted, it won't trigger stacks to close \n   * \n   * When there are other popups or interactive tooltips, that are mounted to the\n        body, this library isn't aware of them, so interacting them by clicking\n        them, will close all open stacks and cause other unintended consequences. If that\n        third-party popup is closed by Escape key, the expectation is that only\n        that popup will close, but Dismiss will close its topmost stack which\n        happens to contain that mounted popup, so \"2 stacks\" will be closed.\n   * \n   * @defaultValue empty array\n   */\n  mountedPopupsSafeList?: string[];\n};\n// stopComponentEventPropagation?: boolean;\n\ntype FocusElementOnCloseOptions = {\n  /**\n   *\n   * focus on element when exiting menuPopup via tabbing backwards ie \"Shift + Tab\".\n   *\n   * @defaultValue `\"menuButton\"`\n   *\n   */\n  tabBackwards?: \"menuButton\" | JSX.Element;\n  /**\n   *\n   * focus on element when exiting menuPopup via tabbing forwards ie \"Tab\".\n   *\n   * @remarks\n   *\n   *  If popup is mounted elsewhere in the DOM, when tabbing outside, this library is able to grab the correct next tabbable element after menuButton, except for tabbable elements inside iframe with cross domain.\n   *\n   * @defaultValue next tabbable element after menuButton;\n   */\n  tabForwards?: \"menuButton\" | JSX.Element;\n  /**\n   * focus on element when exiting menuPopup via click outside popup.\n   *\n   * If mounted overlay present, and popup closes via click, then menuButton will be focused.\n   *\n   * @remarks\n   *\n   * When clicking, user-agent determines which element recieves focus.\n   */\n  click?: \"menuButton\" | JSX.Element;\n  /**\n   *\n   * focus on element when exiting menuPopup via \"Escape\" key\n   *\n   * @defaultValue `\"menuButton\"`\n   */\n  escapeKey?: \"menuButton\" | JSX.Element;\n  /**\n   *\n   * focus on element when exiting menuPopup via scrolling, from scrollable container that contains menuButton\n   *\n   * @dafaultValue `\"menuButton\"`\n   */\n  scrolling?: \"menuButton\" | JSX.Element;\n};\n\nexport type OnOpenHandler = (\n  open: boolean,\n  props: {\n    uniqueId: string;\n    dismissStack: DismissStack[];\n  }\n) => void;\n\nexport type DismissStack = TDismissStack;\n\n/**\n *\n * Handles \"click outside\" behavior for button popup pairings. Closing is triggered by click/focus outside of popup element or pressing \"Escape\" key.\n */\nconst Dismiss: ParentComponent<TDismiss> = (props) => {\n  const modal = props.modal || false;\n  const {\n    id,\n    menuButton,\n    menuPopup,\n    focusElementOnClose,\n    focusElementOnOpen = modal ? \"menuPopup\" : undefined,\n    focusMenuButtonOnMouseDown = true,\n    cursorKeys = false,\n    closeWhenMenuButtonIsTabbed = false,\n    closeWhenMenuButtonIsClicked = true,\n    closeWhenScrolling = false,\n    closeWhenDocumentBlurs = false,\n    closeWhenOverlayClicked = true,\n    closeWhenEscapeKeyIsPressed = true,\n    closeWhenClickingOutside = true,\n    overlay = modal,\n    overlayElement = modal,\n    trapFocus = modal,\n    removeScrollbar = modal,\n    enableLastFocusSentinel = false,\n    mount = modal ? \"body\" : undefined,\n    // stopComponentEventPropagation = false,\n    show = false,\n    onToggleScrollbar,\n    onOpen,\n    deadMenuButton,\n    ignoreMenuPopupWhenTabbing,\n    mountedPopupsSafeList,\n  } = props;\n\n  const state: TLocalState = {\n    mount,\n    modal,\n    addedFocusOutAppEvents: false,\n    closeWhenOverlayClicked,\n    closeWhenDocumentBlurs,\n    closeWhenEscapeKeyIsPressed,\n    closeWhenMenuButtonIsClicked,\n    closeWhenMenuButtonIsTabbed,\n    closeWhenScrolling,\n    closeWhenClickingOutside,\n    cursorKeys,\n    focusElementOnClose,\n    focusMenuButtonOnMouseDown,\n    deadMenuButton,\n    focusElementOnOpen,\n    ignoreMenuPopupWhenTabbing,\n    // @ts-ignore\n    id,\n    uniqueId: createUniqueId(),\n    menuBtnId: \"\",\n    focusedMenuBtn: { el: null },\n    menuBtnKeyupTabFired: false,\n    menuButton,\n    timeouts: {\n      containerFocusTimeoutId: null,\n      menuButtonBlurTimeoutId: null,\n    },\n    upperStackRemovedByFocusOut: false,\n    menuPopup,\n    closeByDismissEvent: false,\n    menuPopupAdded: false,\n    enableLastFocusSentinel,\n    overlay,\n    overlayElement,\n    onToggleScrollbar,\n    removeScrollbar,\n    trapFocus,\n    hasFocusSentinels:\n      !!focusElementOnClose ||\n      overlay ||\n      !!overlayElement ||\n      trapFocus ||\n      enableLastFocusSentinel,\n    mountedPopupsSafeList,\n    open: props.open,\n    setOpen: props.setOpen,\n    onClickOutsideMenuButtonRef: () => onClickOutsideMenuButton(state),\n    onClickOverlayRef: () => onClickOverlay(state),\n    onFocusInContainerRef: (e) => onFocusInContainer(state, e),\n    onFocusOutContainerRef: (e) => onFocusOutContainer(state, e),\n    onBlurMenuButtonRef: (e) => onBlurMenuButton(state, e),\n    onClickMenuButtonRef: (e) => onClickMenuButton(state, e),\n    onMouseDownMenuButtonRef: (e) => onMouseDownMenuButton(state, e),\n    onFocusMenuButtonRef: (e) => onFocusMenuButton(state, e),\n    onKeydownMenuButtonRef: (e) => onKeydownMenuButton(state, e),\n    refContainerCb: (el: HTMLElement) => {\n      if (overlayElement) {\n        el.style.zIndex = \"1000\";\n        if (modal) {\n          el.style.pointerEvents = \"none\";\n          el.style.position = \"relative\";\n\n          const setDialogElStyle = (el: HTMLElement) => {\n            // TODO if it already has id, then update button with aria-controls value\n            if (!el.id) {\n              el.id = state.uniqueId;\n            }\n            el.style.pointerEvents = \"all\";\n            el.setAttribute(\"role\", \"dialog\");\n          };\n          // setDialogElStyle(el);\n          requestAnimationFrame(() => {\n            const dialog = el.querySelector('[role=\"dialog\"]') as HTMLElement;\n            if (!dialog) {\n              const children = el.children;\n              if (!children) return;\n              const dialog = children[1] as HTMLElement;\n              // const child = children[1];\n              // const dialog = child.firstElementChild as HTMLElement;\n              setDialogElStyle(dialog);\n              return;\n            }\n\n            setDialogElStyle(dialog);\n          });\n        }\n      }\n      if (props.ref) {\n        // @ts-ignore\n        props.ref(el);\n      }\n      state.containerEl = el as any;\n    },\n    refOverlayCb: (el: HTMLElement) => {\n      el.style.position = \"fixed\";\n      el.style.top = \"0\";\n      el.style.left = \"0\";\n      el.style.width = \"100%\";\n      el.style.height = \"calc(100% + 100px)\";\n      el.style.zIndex = \"1000\";\n\n      if (typeof overlayElement === \"object\" && overlayElement.ref) {\n        overlayElement.ref(el);\n      }\n\n      state.overlayEl = el as any;\n    },\n  };\n\n  const initDefer = !props.open();\n\n  const resetFocusOnClose = () => {\n    const activeElement = document.activeElement;\n\n    if (activeElement !== document.body) {\n      if (\n        state.menuBtnEls!.every((menuBtnEl) => activeElement !== menuBtnEl) &&\n        !state.containerEl?.contains(activeElement)\n      ) {\n        return;\n      }\n    }\n\n    const { menuBtnEls, focusedMenuBtn, timeouts } = state;\n\n    const menuBtnEl = getMenuButton(menuBtnEls!);\n\n    const el =\n      queryElement(state, {\n        inputElement: focusElementOnClose,\n        type: \"focusElementOnClose\",\n        subType: \"click\",\n      }) || menuBtnEl;\n\n    if (el) {\n      el.focus();\n      if (el === menuBtnEl) {\n        // TODO:?\n        // markFocusedMenuButton({ focusedMenuBtn, timeouts, el });\n      }\n    }\n  };\n\n  const getMountNode = () => {\n    return typeof mount === \"string\" ? document.querySelector(mount)! : mount!;\n  };\n\n  const programmaticRemoval = () => {\n    if (globalState.closedByEvents) return;\n\n    const activeElement = document.activeElement;\n\n    if (\n      // activeElement !== state.menuBtnEls\n      state.menuBtnEls!.every((menuBtnEl) => activeElement !== menuBtnEl) &&\n      !state.containerEl?.contains(activeElement)\n    ) {\n      setTimeout(() => {\n        globalState.closedBySetOpen = false;\n      });\n      return;\n    }\n\n    if (!globalState.closedBySetOpen) {\n      globalState.closedBySetOpen = true;\n\n      setTimeout(() => {\n        globalState.closedBySetOpen = false;\n        resetFocusOnClose();\n      });\n    }\n  };\n\n  createComputed(\n    on(\n      () => !!props.open(),\n      (open, prevOpen) => {\n        if (open === prevOpen) return;\n\n        if (!open) {\n          if (state.focusSentinelAfterEl) {\n            state.focusSentinelAfterEl.tabIndex = -1;\n          }\n          programmaticRemoval();\n        }\n      },\n      { defer: initDefer as any }\n    )\n  );\n\n  createEffect(\n    on(\n      () =>\n        typeof props.menuButton === \"function\"\n          ? props.menuButton()\n          : props.menuButton,\n      (menuButton) => {\n        addMenuButtonEventsAndAttributes({\n          state,\n          menuButton,\n          open: props.open,\n        });\n\n        onCleanup(() => {\n          if (!state || isServer) return;\n\n          // removeMenuButtonEvents(state, true);\n        });\n      }\n    )\n  );\n\n  createEffect(\n    on(\n      () => !!props.open(),\n      (open, prevOpen) => {\n        if (open === prevOpen) return;\n\n        if (open) {\n          globalState.closedByEvents = false;\n          addMenuPopupEl(state);\n          runFocusOnActive(state);\n          setTargetAriaExpandTrue(state);\n\n          addGlobalEvents(closeWhenScrolling);\n\n          addDismissStack({\n            // @ts-ignore\n            id,\n            uniqueId: state.uniqueId,\n            open: props.open,\n            setOpen: props.setOpen,\n            containerEl: state.containerEl!,\n            menuBtnEls: state.menuBtnEls!,\n            focusedMenuBtn: state.focusedMenuBtn,\n            overlayEl: state.overlayEl!,\n            menuPopupEl: state.menuPopupEl!,\n            overlay,\n            closeWhenDocumentBlurs,\n            closeWhenEscapeKeyIsPressed,\n            closeWhenMenuButtonIsTabbed,\n            closeWhenClickingOutside,\n            overlayElement,\n            cursorKeys,\n            focusElementOnClose,\n            focusSentinelBeforeEl: state.focusSentinelBeforeEl,\n            focusSentinelAfterEl: state.focusSentinelAfterEl,\n            ignoreMenuPopupWhenTabbing,\n            upperStackRemovedByFocusOut: false,\n            detectIfMenuButtonObscured: false,\n            queueRemoval: false,\n            mountedPopupsSafeList: state.mountedPopupsSafeList,\n            timeouts: state.timeouts,\n          });\n\n          onOpen && onOpen(open, { uniqueId: state.uniqueId, dismissStack });\n          runToggleScrollbar(state, open);\n          activateLastFocusSentinel(state);\n        } else {\n          setTargetAriaExpandFalse(state);\n          // TODO?:\n          globalState.closedByEvents = false;\n          removeLocalEvents(state);\n\n          removeMenuPopupEl(state);\n          removeDismissStack(state.uniqueId);\n          removeGlobalEvents();\n          removeEventsOnActiveMountedPopup();\n          onOpen && onOpen(open, { uniqueId: state.uniqueId, dismissStack });\n          if (!props.animation) {\n            runToggleScrollbar(state, open);\n          }\n        }\n      },\n      { defer: initDefer as any }\n    )\n  );\n\n  onCleanup(() => {\n    if (isServer) return;\n\n    removeLocalEvents(state, { isCleanup: true });\n\n    removeMenuPopupEl(state);\n    removeDismissStack(state.uniqueId);\n    removeGlobalEvents();\n  });\n\n  function renderOverlay() {\n    if (\n      typeof props.overlayElement === \"object\" &&\n      props.overlayElement.element\n    ) {\n      return props.overlayElement.element;\n    }\n\n    return (\n      <div\n        class={\n          typeof props.overlayElement === \"object\"\n            ? props.overlayElement.class\n            : undefined\n        }\n        classList={\n          typeof props.overlayElement === \"object\"\n            ? props.overlayElement.classList || {}\n            : {}\n        }\n        role=\"presentation\"\n        onClick={state.onClickOverlayRef}\n        onMouseDown={onMouseDownOverlay}\n        onMouseUp={onMouseUpOverlay}\n        ref={state.refOverlayCb}\n      ></div>\n    );\n  }\n\n  function render(children: JSX.Element) {\n    return (\n      <div\n        id={state.id}\n        class={props.class}\n        classList={props.classList || {}}\n        onFocusIn={state.onFocusInContainerRef}\n        onFocusOut={state.onFocusOutContainerRef}\n        ref={state.refContainerCb}\n        // id={props.overlayElement ? state.uniqueId : state.id}\n        // role={props.overlayElement ? \"dialog\" : undefined}\n      >\n        <div\n          tabindex={props.open() ? \"0\" : \"-1\"}\n          onFocus={(e) => {\n            onFocusSentinel(state, \"before\", e.relatedTarget as HTMLElement);\n          }}\n          style=\"position: fixed; top: 0; left: 0; outline: none; pointer-events: none; width: 0; height: 0;\"\n          aria-hidden=\"true\"\n          ref={state.focusSentinelBeforeEl}\n        ></div>\n        {children}\n        <div\n          tabindex={props.open() && state.hasFocusSentinels ? \"0\" : \"-1\"}\n          onFocus={() => {\n            onFocusSentinel(state, \"after\");\n          }}\n          style=\"position: fixed; top: 0; left: 0; outline: none; pointer-events: none; width: 0; height: 0;\"\n          aria-hidden=\"true\"\n          ref={state.focusSentinelAfterEl}\n        ></div>\n      </div>\n    );\n  }\n\n  if (show) return render(props.children);\n\n  // basically <Show>\n  // why custom Show??\n  let strictEqual = false;\n  const condition = createMemo<boolean>(() => props.open(), false, {\n    equals: (a, b) => (strictEqual ? a === b : !a === !b),\n  });\n  const finalRender = createMemo(() => {\n    const c = condition();\n    if (c) {\n      const child = props.children as JSX.Element & (() => { length: number });\n      const fn = typeof child === \"function\" && child.length > 0;\n      strictEqual = fn;\n      return fn ? (\n        untrack(() => (child as any)(c))\n      ) : mount ? (\n        <CustomPortal\n          mount={getMountNode()}\n          overlayChildren={overlayElement ? renderOverlay() : null}\n        >\n          {render(child)}\n        </CustomPortal>\n      ) : (\n        render(child)\n      );\n    }\n  });\n\n  if (props.animation) {\n    return (\n      <Transition\n        {...props.animation}\n        name={props.animation.name}\n        enterClass={props.animation.enterClass}\n        enterActiveClass={props.animation.enterActiveClass}\n        enterToClass={props.animation.enterToClass}\n        exitClass={props.animation.exitClass}\n        exitActiveClass={props.animation.exitActiveClass}\n        exitToClass={props.animation.exitToClass}\n        appear={props.animation.appear}\n        overlay={\n          typeof props.overlayElement === \"object\"\n            ? props.overlayElement.animation!\n            : undefined\n        }\n        state={state}\n      >\n        {finalRender()}\n      </Transition>\n    );\n  }\n\n  return finalRender as unknown as JSX.Element;\n};\n\nexport { getNextTabbableElement };\nexport default Dismiss;\n"],"names":["dismissStack","addDismissStack","props","push","removeDismissStack","id","foundIdx","findIndex","item","uniqueId","foundStack","splice","_tabbableSelectors","reduce","a","c","idx","willWrap","getNextTabbableElement","from","_from","stopAtRootElement","ignoreElement","allowSelectors","direction","wrap","fromResult","_isFromElIframe","Element","activeElement","document","isIframe","getActiveElement","el","parent","parentElement","isFromElIframe","visitedElement","tabbableSelectors","join","traverseNextSiblingsThenUp","hasPassedVisitedElement","children","childrenCount","length","i","child","queryTabbableElement","iframe","result","getIframeWindow","contentWindow","e","getIframeDocument","iframeWindow","iframeDocument","isHidden","windowContext","window","checkByStyle","style","display","visibility","hidden","getComputedStyle","selectors","iterationDirection","init","queryChild","matches","matched","tabindex","getAttribute","documentElement","some","elResult","windowContextResult","shadowRoot","childrenLength","iterateChild","continue","returnVal","foundChild","tagName","hasDisplayNone","offsetHeight","offsetWidth","isObjectLiteral","value","Object","getPrototypeOf","prototype","queryElement","state","inputElement","type","subType","menuPopupEl","getMenuButton","menuBtnEls","target","focusSentinelBeforeEl","containerEl","querySelector","component","tabForwards","tabBackwards","click","escapeKey","scrolling","Array","isArray","map","key","isHiddenOrInvisbleShallow","isInvisible","checkThenClose","arr","checkCb","destroyCb","_continue","onClickMenuButton","timeouts","closeWhenMenuButtonIsClicked","focusedMenuBtn","onClickOutsideMenuButtonRef","onClickOutsideRef","setOpen","open","deadMenuButton","closeWhenClickingOutside","menuBtnMouseDownFired","menuBtnEl","currentTarget","globalState","focusedMenuBtns","forEach","menuBtnKeyupTabFired","add","stackItem","includes","contains","closedByEvents","onBlurMenuButton","overlay","closeWhenDocumentBlurs","currentMenuBtn","queueMicrotask","runLastAfterEvents","relatedTarget","addEventListener","onKeyDownFocusIn","clickedTarget","clickTarget","run","hasFocus","closedBySetOpen","isConnected","clickIsOutside","focus","menuButtonBlurTimeoutId","setTimeout","onMouseDownMenuButton","focusMenuButtonOnMouseDown","onClickMenuButtonRef","onBlurMenuButtonRef","requestAnimationFrame","onClickOutsideMenuButton","onKeydownMenuButton","onKeydownMenuButtonRef","mount","focusSentinelAfterEl","ignoreMenuPopupWhenTabbing","shiftKey","nextElementSibling","preventDefault","removeEventListener","onFocusMenuButton","closeWhenMenuButtonIsTabbed","menuBtn","clearTimeout","containerFocusTimeoutId","undefined","find","addMenuButtonEventsAndAttributes","menuButton","_","self","addAriaLabels","onMouseDownMenuButtonRef","onFocusMenuButtonRef","preventScroll","targetEl","modal","hasAttribute","setAttribute","setTargetAriaExpandTrue","setTargetAriaExpandFalse","removeMenuButtonEvents","isCleanup","getActiveMountedPopupFromSafeList","safeList","thirdPartyPopupEl","els","selector","foundEl","getFirstVisibleMountedPopupFromSafeList","addEventsToActiveMountedPopup","onClickDocument","onKeyDown","capture","removeEventsOnActiveMountedPopup","thirdPartyPopupElPressedEscape","scrollEventAddedViaTouch","scrollEventAdded","pollTimeoutId","timestampOfTabkey","cachedScrollTarget","cachedPolledElement","closeByFocusSentinel","documentClickTimeout","Set","cursorKeysPrevEl","overlayMouseDown","runLastAfterEventsTimerId","onDocumentPointerUp","onDocumentPointerDown","onWindowBlur","difference","timeStamp","onBlurWindow","overlayEl","pollingIframe","onVisibilityChange","cursorKeys","closeWhenEscapeKeyIsPressed","focusElementOnClose","mountedPopupsSafeList","onCursorKeys","close","onScrollClose","addGlobalEvents","closeWhenScrolling","passive","body","onTouchMove","removeGlobalEvents","once","keys","horizontalKeys","isCursorKeysArgObj","currentEl","prevEl","visibilityState","duration","poll","addMenuPopupEl","menuPopup","menuPopupAdded","removeMenuPopupEl","camelize","s","replace","x","toUpperCase","runToggleScrollbar","onToggleScrollbar","removeScrollbar","onRemove","onRestore","scrollingElement","overflow","nextFrame","fn","Transition","first","isPortal","portalMarker","isExiting","hasOverlayAnimation","s1","set1","createSignal","s2","set2","resolved","onBeforeEnter","onEnter","onAfterEnter","onBeforeExit","onExit","onAfterExit","appendToElement","appear","onBeforeEnterOverlay","onEnterOverlay","onAfterEnterOverlay","onBeforeExitOverlay","onExitOverlay","onAfterExitOverlay","appendToElementOverlay","createOnBeforeEnter","createOnEnter","createOnAfterEnter","createOnBeforeExit","createOnExit","createOnAfterExit","getClassState","animatedElType","getName","name","propStr","classAnimationStates","classState","split","getElement","appendToElement_","endExitTransitionRef","endExitTransitionOverlayRef","enterTransition","_el","prev","enterClasses","enterActiveClasses","enterToClasses","classList","remove","endTransition","batch","el_","mode","exitTransition","_prev","exitClasses","exitActiveClasses","exitToClasses","parentNode","createComputed","nodeType","willRemove","portalContainerChild","overlayChildren","defineProperty","get","configurable","untrack","portalOverlay","removeLocalEvents","onFocusOutContainer","overlayElement","trapFocus","timeoutFocusOutFired","dismissStackLength","setTimeoutFocusOut","onFocusInContainer","runFocusOnActive","focusElementOnOpen","cb","onMouseDownOverlay","onMouseUpOverlay","onClickOverlay","closeWhenOverlayClicked","matchByFirstChild","matchEl","query","activateLastFocusSentinel","enableLastFocusSentinel","menuBtnSibling","onFocusSentinel","runIfMounted","isFirst","SVG_NAMESPACE","createElement","isSVG","createElementNS","CustomPortal","useShadow","isModal","marker","createTextNode","renderPortal","sharedConfig","context","set","HTMLHeadElement","clean","setClean","cleanup","createRoot","dispose","insert","onCleanup","container","renderRoot","attachShadow","containerObjectValue","firstElementChild","insertAdjacentElement","appendChild","ref","removeChild","Dismiss","show","onOpen","addedFocusOutAppEvents","createUniqueId","menuBtnId","upperStackRemovedByFocusOut","closeByDismissEvent","hasFocusSentinels","onClickOverlayRef","onFocusInContainerRef","onFocusOutContainerRef","refContainerCb","zIndex","pointerEvents","position","setDialogElStyle","dialog","refOverlayCb","top","left","width","height","initDefer","resetFocusOnClose","every","getMountNode","programmaticRemoval","on","prevOpen","tabIndex","defer","createEffect","isServer","detectIfMenuButtonObscured","queueRemoval","animation","renderOverlay","element","class","render","strictEqual","condition","createMemo","equals","b","finalRender","enterClass","enterActiveClass","enterToClass","exitClass","exitActiveClass","exitToClass"],"mappings":"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"}