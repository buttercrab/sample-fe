import { mergeProps } from '@zag-js/solid';
import { createEffect } from 'solid-js';
import { PresenceProvider, splitPresenceProps, usePresence, } from '../presence';
import { MenuProvider, useMenuContext } from './use-menu-context';
import { MenuMachineProvider, useMenuMachineContext } from './use-menu-machine-context';
import { MenuTriggerItemProvider } from './use-menu-trigger-item-context';
export const MenuRootProvider = (props) => {
    const parentApi = useMenuContext();
    const parentMachine = useMenuMachineContext();
    const [presenceProps, menuProps] = splitPresenceProps(props);
    const presenceApi = usePresence(mergeProps(presenceProps, () => ({ present: menuProps.value.api().open })));
    createEffect(() => {
        if (!parentMachine)
            return;
        parentApi?.().setChild(menuProps.value.machine);
        menuProps.value.api().setParent(parentMachine);
    });
    const triggerItemContext = () => parentApi?.().getTriggerItemProps(menuProps.value.api());
    return (<MenuTriggerItemProvider value={triggerItemContext}>
      <MenuMachineProvider value={menuProps.value.machine}>
        <MenuProvider value={menuProps.value.api}>
          <PresenceProvider value={presenceApi}>{menuProps.children}</PresenceProvider>
        </MenuProvider>
      </MenuMachineProvider>
    </MenuTriggerItemProvider>);
};
